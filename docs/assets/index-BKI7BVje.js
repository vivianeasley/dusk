(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(t){if(t.ep)return;t.ep=!0;const o=a(t);fetch(t.href,o)}})();const Ne=(e,s)=>{let a=structuredClone(e),n=!1;const t=()=>structuredClone(a),o=l=>{s(l),a=l};return n===!1&&(s(e),n=!0),{get:t,set:o}},g=(e,...s)=>e.reduce((a,n,t)=>a+n+(s[t]??""),""),N=(e,s)=>e.map(s).join(""),be=(e,s)=>{e.innerHTML=s()};function qe(){const e=new Map;return{startFlip(){e.clear(),document.querySelectorAll("[data-flip]").forEach(s=>{const a=s.getAttribute("data-flip");e.set(a,s.getBoundingClientRect())})},endFlip(s=200){return new Promise(a=>{const n=[];document.querySelectorAll("[data-flip]").forEach(t=>{const o=t.getAttribute("data-flip"),l=e.get(o);if(!l)return;const c=t.getBoundingClientRect(),d=l.left-c.left,T=l.top-c.top;(d!==0||T!==0)&&(t.style.transform=`translate(${d}px, ${T}px)`,n.push(t))}),requestAnimationFrame(()=>{n.forEach(t=>{t.style.transition=`transform ${s}ms ease`,t.style.transform=""}),setTimeout(()=>{n.forEach(t=>{t.style.transition=""}),e.clear(),a()},s)})})}}}const x=e=>new Promise(s=>setTimeout(s,e)),De=e=>{for(let s=e.length-1;s>0;s--){const a=Math.floor(Math.random()*(s+1));[e[s],e[a]]=[e[a],e[s]]}return e},J=e=>{if(!e)return"";let s=e.replace(/([a-z])([A-Z0-9])/g,"$1 $2");return s=s.toLowerCase(),s=s.charAt(0).toUpperCase()+s.slice(1),/[.!?]$/.test(s)||(s+="."),s},O=e=>e[Math.floor(Math.random()*e.length)],pe=()=>Math.random(),Pe=e=>Math.floor(Math.random()*e)+1,$e=(e,s,a={})=>{var T,L;const n=e.getAttribute("d");if(!n)throw new Error(`Element "${id}" has no 'd' attribute`);const t=/-?\d*\.?\d+(?:e[-+]?\d+)?/gi,o=(T=n.match(t))==null?void 0:T.map(Number),l=(L=s.match(t))==null?void 0:L.map(Number);if(!o||!l||o.length!==l.length)throw new Error("Start and target paths must have identical command structure and number count.");const c=a.easing||(M=>.5-.5*Math.cos(Math.PI*M)),d=Math.max(1,a.duration||800);return new Promise(M=>{const R=($,b,I)=>$+(b-$)*I;let w;function E($){w??(w=$);const b=Math.min(1,($-w)/d),I=c(b),u=o.map((y,A)=>R(y,l[A],I)),h=n.replace(t,()=>{const y=u.shift();return Math.abs(y)<1e-6?"0":y.toFixed(3).replace(/\.?0+$/,"")});e.setAttribute("d",h),b<1?requestAnimationFrame(E):M()}requestAnimationFrame(E)})},oe=e=>{const s=document.querySelectorAll(".upper-brow"),a=e?600:600+Pe(200),n=`m-6,0l649,0l0,${a}c-119.17,-95.85 -41.92,-306.25 -163.12,-392.89c-104.61,-77.09 -381.27,-13.02 -485.88,-90.11z`;for(let t=0;t<s.length;t++)$e(s[t],n,{duration:200+a*3})},fe=e=>{const s=document.querySelectorAll(".iris"),a=e?"m345.22,45c-188.76,49.98 -199.63,117.3 -216.1,197.88c2.69,140.76 156.4,202.98 220.35,210.12c2.13,0 200.44,-22.44 196.5,-210.12c-5.14,-149.94 -200.76,-197.88 -200.76,-197.88z":"m330.55,45c-23.96,49.98 -25.34,117.3 -27.43,197.88c0.34,140.76 19.85,202.98 27.97,210.12c0.27,0 25.44,-22.44 24.94,-210.12c-0.65,-149.94 -25.48,-197.88 -25.48,-197.88z";for(let n=0;n<s.length;n++)setTimeout(()=>{$e(s[n],a,{duration:500})},2200)},D=(e,{size:s=256,cell:a=14,jitter:n=.85}={})=>{const t=s,o=u=>Math.max(0,Math.min(t-1,u)),l=document.createElement("canvas");l.width=l.height=t;const c=l.getContext("2d",{willReadFrequently:!0});function d(u,h){c.clearRect(0,0,t,t),c.textAlign="center",c.textBaseline="middle",c.font=`${t*.78}px ${h}`,c.fillStyle="#000",c.fillText(u,t/2,t/2)}function T(){const u=c.getImageData(0,0,t,t).data;for(let h=3;h<u.length;h+=4)if(u[h]!==0)return!0;return!1}const L=['"Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji",sans-serif','"Segoe UI Emoji","Noto Color Emoji","Apple Color Emoji",sans-serif',"sans-serif"];let M=!1,R=e;for(let u=0;u<3&&!M;u++)d(R,L[u]),M=T(),!M&&u===0&&!/\uFE0F/.test(R)&&(R=e+"️",u--);M||(c.clearRect(0,0,t,t),c.fillStyle="#000",c.fillRect(t*.25,t*.25,t*.5,t*.5));const w=[],E=a*n*.5;for(let u=0;u<=t;u+=a){const h=[];for(let y=0;y<=t;y+=a){const A=y>0&&y<t?(Math.random()*2-1)*E:0,F=u>0&&u<t?(Math.random()*2-1)*E:0;h.push([o(y+A),o(u+F)])}w.push(h)}const $=document.createElement("canvas");$.width=$.height=t;const b=$.getContext("2d");function I(u,h,y){const A=o((u[0]+h[0]+y[0])/3|0),F=o((u[1]+h[1]+y[1])/3|0),S=c.getImageData(A,F,1,1).data;S[3]<1||(b.beginPath(),b.moveTo(u[0],u[1]),b.lineTo(h[0],h[1]),b.lineTo(y[0],y[1]),b.closePath(),b.fillStyle=`rgba(${S[0]},${S[1]},${S[2]},${(S[3]/255).toFixed(3)})`,b.fill())}for(let u=0;u<w.length-1;u++)for(let h=0;h<w[u].length-1;h++){const y=w[u][h],A=w[u][h+1],F=w[u+1][h],S=w[u+1][h+1];Math.random()<.5?(I(y,A,S),I(y,S,F)):(I(y,A,F),I(A,S,F))}return $.toDataURL("image/png")},ke=(e,s)=>{if(console.log(s),typeof s!="number"||s<=0){const a=e.get(),n=a.activePlayer==="player"?"player":"opponent";let t=0;for(let o=0;o<a[n].play.length;o++)a[n].play[o].types.includes(s)&&a[n].play[o].isExhausted===!1&&t++;return t}return s},Ue=e=>e.deck[e.deck.length-1],xe=(e,s,a,{toStart:n=!1}={})=>{const t=e.findIndex(l=>l.id===a);if(t===-1)return null;const[o]=e.splice(t,1);return n?s.unshift(o):s.push(o),o},Te=async(e,s)=>{for(let a=0;a<e&&await s(a)!==!1;a++);};async function Z(e,s,a){const n=ke(e,a);await Te(n,async()=>{const t=e.get(),o=Ue(t);if(!o)return!1;o.isFaceUp=!0,xe(t.deck,t[s].play,o.id),e.set(t),await x(1e3)})}async function he(e,s,a){const n=ke(e,a);await Te(n,async()=>{const t=e.get(),o=t[s].play;if(!o.length)return!1;const l=o[o.length-1];if(!l)return!1;l.isFaceUp=!1,xe(o,t.deck,l.id,{toStart:!0}),e.set(t),await x(1e3)})}const de={floodOpponent$Time:async(e,s,a)=>{await Z(e,s==="player"?"opponent":"player",a)},floodAllPlayers$Time:async(e,s,a)=>{await Z(e,"player",a),await Z(e,"opponent",a)},return$Time:async(e,s,a)=>{await he(e,s,a)},forEach$InYourPlayAreaFloodYourOpponent:async(e,s,a)=>{await Z(e,s==="player"?"opponent":"player",a)},forEach$InYourPlayAreaReturnACard:async(e,s,a)=>{await he(e,s,a)},remianingCardsInPileGoToYourPlayArea:async(e,s,a)=>{await x(1e3);const n=e.get();n.isPileToPlay=!0,e.set(n)},turn2$OfYourOpponentsCardsFaceDown:async(e,s,a)=>{await x(1e3);const n=e.get(),t=n.activePlayer;let o=t==="player"?n.opponent.play:n.player.play,l=0;for(let c=0;c<o.length;c++){const d=o[c];if(console.log(d.types,a),!d.isExhausted&&d.types.includes(a)&&(d.isExhausted=!0,l++),l>=2)break}l>=15&&(n.winner=t==="player"?"You":"The Void"),e.set(n)},ifYouHave10OrMore$CardsYouWinTheGame:async(e,s,a)=>{await x(1e3);const n=e.get(),t=n.activePlayer;let o=t==="player"?n.player.play:n.opponent.play,l=0;o.forEach(c=>{!c.isExhausted&&c.types.includes(a)&&l++}),l>=10&&(n.winner=t==="player"?"You":"The Void"),e.set(n)}},Ae=["💖","💘","💝","🔥","💃","💄","🌋","🌶️","🍅","🥩","🧨","🎈","🎉","📕","☎️","🚗","🚒","🛑","🦑","🧯","🦀","🦞","🦐","🧣","🦊","🦁","🪔","🛢️","🧱"],Me=["🧊","🌊","🌀","❄️","☃️","🌌","🪐","⭐","🌠","🧞","🦋","🐬","🐟","🐳","🐢","🐍","🐸","🦖","🌴","🌳","🍀","🌿","🍏","🥝","🥒","🥦","🫐","🧵","👖","📘","💎","🔵","🔷","🟩","🟦","🕺"],Se=["🤍","🖤","🤎","🪨","🏺","🪵","🪑","⚱️","⚙️","📦","📜","📄","📓","📰","💼","🥋","🥔","🍞","🥖","🪙","💰","🛋️","🪞","🧳","🏚️","⚫","⚪","📎","🧂","🗿","🛡️"],ee=["Umbral","Void","Eclipse","Oblivion","Specter","Nebula","Wraith","Abyss","Crypt","Ethereal","Stellar","Hollow","Phantom","Cosmic","Chasm","Lunar","Grave","Singularity","Haunt","Infernal","Asteroid","Orbit","Shadow"],V=["rift","echo","omen"],ye={rift:Be,echo:Ve,omen:Ye},q=Object.keys(de),te={};let Ee=3,Ie=3,Ce=3;const re=["c","c","c","c","c","c","c","c","c","u","u","u","u","r","r"],ze=e=>{const s=[];for(let a=0;a<5;a++){const n=V[a]?V[a]:V[a-2];s.push(ae([n],s.length+1,void 0,a))}return re.forEach(a=>{const n=le(["rift"],a);Ee++,s.push(ae(["rift"],s.length+1,n,3))}),re.forEach(a=>{const n=le(["echo"],a);Ie++,s.push(ae(["echo"],s.length+1,n,3))}),re.forEach(a=>{const n=le(["omen"],a);Ce++,s.push(ae(["omen"],s.length+1,n,3))}),De(s)};function ae(e,s,a,n){return{id:s,name:a!=null&&a.name?a.name:Fe(),types:e,isFaceUp:!1,isSelected:!1,isActive:!1,abilityFunct:a?a.abilityFunct:[],abilityRule:a?a.abilityRule:[],isExhausted:!1,cardArt:a!=null&&a.art?a.art:t()};function t(){let o;return e.length>1||(e[0]==="rift"?o=D(Ae[n],{size:100,cell:12}):e[0]==="echo"?o=D(Me[n],{size:100,cell:12}):o=D(Se[n],{size:100,cell:12})),o}}function Be(e,s,a){let n=a||1,t=e==="c"?0:1;e==="r"&&(n=O(V),t=3);const o=q[t];return{funct:o+":"+n,rule:J(o.replace("$"," "+n+" "))}}function Ve(e){let s=1,a=2;e==="r"&&(s=O(V),a=4);const n=q[a];return{funct:n+":"+s,rule:J(n.replace("$"," "+s+" "))}}function Ye(e,s){if(e==="c")return{funct:q[5],rule:J(q[5])};if(e==="u"){const a=O(V);return{funct:q[6]+":"+s,rule:J(q[6].replace("$"," "+a+" "))}}else{const a=O(V);return{funct:q[7]+":"+s,rule:J(q[7].replace("$"," "+a+" "))}}}function le(e,s){let a=[],n=[];for(let l=0;l<e.length;l++){const c=e[l],d=ye[c](s,e[l]);if(a.push(d.funct),n.push(d.rule),c==="omen"&&s==="r"){const T=ye.rift("c","omen",2);a.push(T.funct),n.push(T.rule)}}const t=a.join("")+e.join("");let o={};if(te[t])o.name=te[t].name,o.art=te[t].art;else{let l;e.length>1||(e[0]==="rift"?l=D(Ae[Ee],{size:100,cell:12}):e[0]==="echo"?l=D(Me[Ie],{size:100,cell:12}):l=D(Se[Ce],{size:100,cell:12})),o.name=Fe().slice(0,21),o.art=l,te[t]=o}return{name:o.name,art:o.art,abilityFunct:a,abilityRule:n}}function Fe(){const e=pe(),s=pe(),a=O(ee),n=O(ee),t=e>.5?a:`${a.slice(0,a.length-3)}'${O(ee)}`,o=s>.5?n:`${O(ee)}-${n}`;return`${t} ${o}`}const Oe=["deal","take","end"],Ge=()=>new Promise(e=>{e({isIntroSkipped:!1,isUiHidden:!0,storyIndex:0,isStarted:!1,isPhaseButtonDisabled:!0,isPileToPlay:!1,winner:void 0,activePlayer:"player",currentPhase:void 0,phases:Oe,isModalOpen:!1,ui:{},deck:ze(),selectedPile:"pile1",pile1:[],pile2:[],pile3:[],player:{id:1,hand:[],play:[],isComputer:!1},opponent:{id:2,hand:[],play:[],isComputer:!0}})}),ue=["","Well, well, well. Look what we have here?","A small flicker of light at dusk.","Delicious. I so rarely get guests","I so rarely get any guests... guests.","It's all so terrIBLY BORING I JUST WANT...","...I'm sorry I forget myself, forgot myself.","Welcome, you who stands at the edge twilight.","Come, sit with me and play a game.","It tastes like cards, and you wager yourself.","The night is almost here... you get the first play."],We=D("🌌",{size:500,cell:15});function B(e,s,a,n,t){var l,c;let o=e.types[0];return e.types.length>1&&(o="multi"),g`
    <div class="card-wrapper ${e.isActive?"active-card":""} ${e.isExhausted?"played":""}" ${s?"":"data-flip="+e.id}>
      <div class="card-container ${e.isFaceUp||a?"face-up":"face-down"}">
        <div class="card ${n?"pulse-border":""}">
          <div class="card-face front ${o}">
            <div class="card-name">${e.name}</div>
            <img class="card-image" src="${e.cardArt}">
            ${e.isExhausted?"":g`<div class="card-type">${(l=e.types)==null?void 0:l.join(" - ")}</div>`}
            <div class="card-rules">${(c=e.abilityRule)==null?void 0:c.join(`.
`)}</div>
          </div>

          <div class="back">
          <img class="back-pattern" src="${We}">
          </div>
        </div>
      </div>
    </div>
  `}function He(e){return g`
        <div class="dialog">
            <div class="game-rules-wrapper">
                <div class="flex-col">
                    <h3>Rules</h3>
                    <div>Goal: If a player ends their turn with 15 cards in their play area they lose the game.</div>
                    <div>m Key: Turn on music - s Key: Skip intro</div>
                    <div>
                        <ol>
                            <li>Each turn a card is dealt to each of 3 piles.</li>
                            <li>Then the active player chooses a pulsing blue pile.</li>
                            <li>All cards from the chosen pile are played in the chosen numerical order.</li>
                            <li>Played cards go to the bottom of the deck.</li>
                            <li>If the active player doesn't have 15 or more cards in their play area their opponent goes and the above steps are repeated.</li>
                        </ol>
                    </div>
                    <div>
                    <h3>Terms</h3>
                    <ul>
                        <li>Flood: Force your opponent to draw a card and put it in their play area.</li>
                        <li>Exhausted: Cards can become exhausted in play areas. They are no longer counted by card abilities but they are counted towards the 15 cards that cause you to lose the game.</li>
                        <li>Return: Return a card from you play area to the bottom of the deck. Exhausted cards are returned first followed by the last card you played.</li>
                    </ul>
                    </div>
                    <div><button class="jagged" onclick="methods.cancelPlayModal()">Start the Game</button></div>
                </div>
            </div>
        </div>
  `}function Ke(e){let s=0,a=0,n=0;for(let t=0;t<e.player.play.length;t++)e.player.play[t].types.includes("rift")&&s++,e.player.play[t].types.includes("echo")&&a++,e.player.play[t].types.includes("omen")&&n++;return g`
        <div class="dialog">
            <div>
                <div>Select this pile of cards by clicking the take button. Cards resolve in numerical order.</div>
                <div>Your play area has ${s} rifts, ${a} echos, and ${n} omens</div>
            </div>
            <div class="flex-column">
                <div class="flex-cards">
                ${N(e[e.selectedPile],(t,o)=>{var l;return g`
                        <div>
                            <div class="deck-card-wrapper">${B(t,!0,!0)}</div>
                        ${((l=e[e.selectedPile])==null?void 0:l.length)>1?g`<div class="number-buttons-wrapper"><button class="jagged" onclick="methods.orderCards(['${e.selectedPile}'], ${t.id}, false)">⬅</button><div class="number">${o+1}</div><button class="jagged" onclick="methods.orderCards(['${e.selectedPile}'], ${t.id}, true)">⮕</button></div>`:""}
                        </div>`})}
                </div>

            </div>
            <div class="flex-row dialog-ui">
                <button class="jagged" onclick="methods.cancelTakeModal()">Close</button>
                <button class="jagged" onclick="methods.submitTakeModal()">Take & Pass</button>
            </div>
        </div>
  `}function Qe(e){var t,o,l;const s=Oe[e.currentPhase],n=(e.currentPhase?["play","end"]:["take","end"]).includes(s)?e.activePlayer==="player"?"opponent":"player":e.activePlayer;return g`
    <div class="${e.isStarted?"hidden":""}" id="story-wrapper">
        ${N(ue,(c,d)=>d>e.storyIndex?null:d===e.storyIndex?g`<div class="last-line">${c}</div>`:g`<div>${c}</div>`)}
    </div>
    <div class="${e.isStarted?"":"ui-wrapper"}">
        <div>
            <div class="phases-wrapper ${n!=="player"?"void-phase jagged":""}">
                ${n==="player"?"YOUR TURN: ":"VOID'S TURN: "}
                ${N(e.phases,(c,d)=>g`<div class="phase-wrapper ${e.currentPhase===d?"active":""}">${c.toUpperCase()}</div>`)}
            </div>
            <div class="game-area-wrapper">
                <div class="deck-dealt-wrapper">
                    <div class="deck-wrapper">${N(e.deck,(c,d)=>g`<div class="deck-card-wrapper" style="${"bottom:"+Math.floor(d/3)+"px;right:"+Math.floor(d/6)+"px"}">${B(c)}</div>`)}</div>
                    <div class="pile-wrapper pile-1-wrapper">${((t=e.pile1)==null?void 0:t.length)>0?N(e.pile1,(c,d)=>g`<div onclick="methods.viewPile('pile1')" class="pile" style="${"bottom:"+d*2+"px;right:"+d*2+"px"}">${B(c,!1,!1,e.currentPhase===1&&e.activePlayer==="player")}</div>`):""}</div>
                    <div class="pile-wrapper pile-2-wrapper">${((o=e.pile2)==null?void 0:o.length)>0?N(e.pile2,(c,d)=>g`<div onclick="methods.viewPile('pile2')" class="pile" style="${"bottom:"+d*2+"px;right:"+d*2+"px"}">${B(c,!1,!1,e.currentPhase===1&&e.activePlayer==="player")}</div>`):""}</div>
                    <div class="pile-wrapper pile-3-wrapper">${((l=e.pile3)==null?void 0:l.length)>0?N(e.pile3,(c,d)=>g`<div onclick="methods.viewPile('pile3')" class="pile" style="${"bottom:"+d*2+"px;right:"+d*2+"px"}">${B(c,!1,!1,e.currentPhase===1&&e.activePlayer==="player")}</div>`):""}</div>
                </div>
                
            </div>

        </div>
        <div class="flex-row-top">
            <div class="play-area-wrapper area-wrappers play-area-min-height">
                <div class="play-area-header">⚪ YOUR PLAY AREA (${e.player.play.length+e.player.hand.length})</div>
                <div class="flex-cards">
                ${N(e.player.play,(c,d)=>g`<div>${B(c,!0,!0,!1)}</div>`)}
                </div>
            </div>

            <div class="play-area-wrapper area-wrappers play-area-min-height">
                <div class="play-area-header">⚫ THE VOIDS'S PLAY AREA (${e.opponent.play.length+e.opponent.hand.length})</div>
                <div class="flex-cards">
                    ${N(e.opponent.play,(c,d)=>g`<div class="pile">${B(c,!0,!0,!1)}</div>`)}
                </div>
            </div>    
        
        </div>
        </div>  
        <div class="dialog-wrapper ${e.isModalOpen||e.storyIndex===0?"":"hidden"}">
            ${e.storyIndex===0?He():null}
            ${e.currentPhase===1&&e.isStarted===!0?Ke(e):null}
        </div>
 
  `}const _e=D("😶",{size:500,cell:20}),me=e=>g`
        <div class="eye-wrapper" ${e?"style='transform: scaleX(-1)'":""}>
            <img class="eye-background" src="${_e}">
            <svg class="eye-layer" viewBox="0 0 622 500" preserveAspectRatio="xMaxYMin">
                <g class="layer">
                <path class="upper-brow" d="m-6,0l649,0l0,890c-119.17,-95.85 -41.92,-306.25 -163.12,-392.89c-104.61,-77.09 -381.27,-13.02 -485.88,-90.11z" fill="#000000" id="svg_16" stroke="#000000" stroke-width="0"/>
                <path d="m-3,-1c0.68,161 1.35,322 2.03,483l642.97,0c-94.8,-70.22 -336.89,9.59 -431.69,-60.63c-120.2,-90.78 -93.11,-331.59 -213.31,-422.37z" fill="#000000" id="svg_17" stroke="#000000" stroke-width="0"/>
                <path class="iris" d="m330.55,45c-23.96,49.98 -25.34,117.3 -27.43,197.88c0.34,140.76 19.85,202.98 27.97,210.12c0.27,0 25.44,-22.44 24.94,-210.12c-0.65,-149.94 -25.48,-197.88 -25.48,-197.88z" fill="#000000" stroke="#000000" stroke-width="0"/>
                </g>
            </svg>
        </div>
    `,Je=()=>g`
        <div class="eyes-wrapper">
            ${me(!1)}
            ${me(!0)}
        </div>
    `,Xe=(e,s,a)=>{const n=typeof s=="object"&&s?s:{wave:typeof s=="string"?s:"sine",musicLength:void 0},t=n.wave||"sine",o=n.musicLength??.1,l=n.transposeOctaves??-2,c=n.transposeSemitones??0,d=n.baseHz??440,T=n.baseCharCode??105,L=n.filterCutoff??450,M=n.filterQ??10,R=n.subLevel??.35,w=n.subOctaves??1,E=n.gain??.45,$=n.attack??.01,b=n.decay??.12,I=n.sustain??.2,u=n.release??.3,h=n.vibratoRate??5,y=n.vibratoDepth??12,A=n.delayTime??.23,F=n.delayFeedback??.33,S=n.delayWet??.25,H={5:.4,4:.3,3:.2,2:.1,1:.05},se=[...Object.keys(H),"-"];window.AudioContext=window.AudioContext||window.webkitAudioContext;const k=new AudioContext,Y=k.createGain();Y.gain.value=.9,Y.connect(k.destination);const i=k.createDelay(1.5);i.delayTime.value=A;const r=k.createGain();r.gain.value=F;const p=k.createGain();p.gain.value=S,i.connect(r),r.connect(i),i.connect(p),p.connect(Y);for(let f=0;f<e.length;f++){const m=e[f],P=e[f+1],C=isNaN(P)?o:H[P];if(!m||se.includes(m))continue;const v=k.currentTime+f*C+.3,j=v+C,K=e.charCodeAt(f)-T+l*12+c,U=d*Math.pow(2,K/12),G=k.createOscillator();G.type=t,G.frequency.setValueAtTime(U,v);const Q=k.createOscillator();Q.type=t==="square"?"sine":t;const Le=U/Math.pow(2,w);Q.frequency.setValueAtTime(Le,v);const ne=k.createGain();ne.gain.value=R;const W=k.createBiquadFilter();W.type="lowpass",W.frequency.setValueAtTime(L,v),W.Q.setValueAtTime(M,v);const z=k.createGain();if(z.gain.setValueAtTime(1e-4,v),z.gain.linearRampToValueAtTime(E,v+$),z.gain.linearRampToValueAtTime(E*I,v+$+b),z.gain.setTargetAtTime(1e-4,Math.max(v,j-u),.15),y>0){const X=k.createOscillator(),ie=k.createGain();X.frequency.setValueAtTime(h,v);const Re=je=>je*(Math.pow(2,y/1200)-1);ie.gain.value=Re(U),X.connect(ie),ie.connect(G.frequency),X.start(v),X.stop(j+.1)}G.connect(W),Q.connect(ne),ne.connect(W),W.connect(z),z.connect(Y),z.connect(i),G.start(v),Q.start(v),G.stop(j+.05),Q.stop(j+.05)}},Ze=()=>{const e=["m5","k5","h5","o5","g5","k3","h3","m3","k2","h2","m4"],s=["-m5-k5-h5-m5-","-m5-k5-h5-k5-","-o5-m5-k5-h5-","-h5-g5-k5-h5--","-k3-h3-m5--k3-h3-m5--","-m5-m5-k5-h5-m5--","-a5-h5-g5-d5-c5-a5-a5-","-a5-h5-g5-d5-c5-k25-k25-","-o5-j5-k5-g5-h5-h5-c5-","-m5-g5-j5-c5-h3"];let a="";for(let n=0;n<200;n++){const t=Math.random()>.7?"---":"--",o=Math.random()>.9?O(e):O(s);a+=o+t}Xe(a,{wave:"sawtooth",musicLength:.4,transposeOctaves:-3,filterCutoff:320,filterQ:14,subLevel:.45,subOctaves:2,attack:.03,decay:.2,sustain:.35,release:.6,vibratoRate:4,vibratoDepth:14,delayTime:.38,delayFeedback:.38,delayWet:.22,gain:.2})},ge=qe();let ve=!1,_=0,ce=!1;const we=(e,s)=>s.length>1?e[s[0]][s[1]]:e[s[0]],et=document.querySelector("#app"),tt=document.querySelector("#eyes"),at=e=>{ge.startFlip(),be(et,()=>Qe(e)),ge.endFlip(500)};setTimeout(()=>{st()},200);async function st(){const e=()=>{_++},s=()=>{_=Math.max(0,_-1),_===0&&ce&&(ce=!1,w())},a=async()=>{if(_>0){ce=!0;return}await w()};if(ve)return;ve=!0;const n=await Ge(),t=Ne(n,at);nt(),it(t),be(tt,()=>Je());const o=()=>{const i=t.get();return i.phases[i.currentPhase??0]},l=i=>o()===i,c=i=>i.deck[i.deck.length-1],d=(i,r,p,{toStart:f=!1}={})=>{const m=i.findIndex(C=>C.id===p);if(m===-1)return!1;const[P]=i.splice(m,1);return f?r.unshift(P):r.push(P),!0},T=i=>{const r=t.get();for(const p of["pile1","pile2","pile3"]){let f=r.deck;if(r.isPileToPlay&&(f=r.activePlayer==="player"?r.player.play:r.opponent.play),d(r[p],f,i,{toStart:!0}))return t.set(r),!0}return!1},L=()=>{for(let i=1;i<=3;i++){const r=t.get(),p=c(r);if(!p)break;d(r.deck,r[`pile${i}`],p.id),t.set(r)}},M=async(i,r,p)=>{if(!i||!Array.isArray(i.abilityFunct))return;e();for(let C=0;C<i.abilityFunct.length;C++){const v=i.abilityFunct[C],[j,K]=String(v).split(":");let U=K?parseInt(K,10):0;Number.isNaN(U)&&(U=K),de[j]&&await de[j](t,r,U)}const f=t.get();let m;p.length>1?m=f[p[0]][p[1]]:m=f[p[0]];const P=m.find(C=>C.id===i.id);P&&(P.isFaceUp=!1,P.isActive=!1,t.set(f)),s()},R=()=>{const i=t.get(),r=i.currentPhase===void 0||i.currentPhase+1>=i.phases.length?0:i.currentPhase+1;return i.currentPhase=r,t.set(i),i.phases[r]};async function w(){const i=t.get();if(i.winner){alert(`${i.winner} has won the game`);return}const r=R();i.activePlayer==="player"?await $(r):await b(r)}const E=i=>{const r=t.get();r.isPhaseButtonDisabled=i,t.set(r)};async function $(i){E(!0),i==="deal"&&(oe(!0),L(),await x(500),await a()),i!=="take"&&i==="end"&&(H(),await a())}async function b(i){E(!0),i==="deal"&&(fe(!0),L(),await x(500),await a()),i==="take"&&(await I(),await x(3e3),E(!1)),i==="end"&&(fe(!1),H(),await a())}async function I(){e(),oe();const i=t.get(),r=Math.max(1,Math.min(3,Pe(3)));i.selectedPile=`pile${r}`,t.set(i),await x(200),await u(),s(),await a()}async function u(){for(;;){const r=t.get(),p=r[r.selectedPile];if(!Array.isArray(p)||p.length===0)break;const f=p[p.length-1];if(!f||(f.isFaceUp=!0,f.isActive=!0,t.set(r),await x(1e3),await M({...f},r.activePlayer,[r.selectedPile]),!T(f.id)))break;await x(1e3)}const i=t.get();i.isPileToPlay=!1,i.player.play=i.player.play.sort(r=>r.isExhausted),i.opponent.play=i.opponent.play.sort(r=>r.isExhausted),t.set(i)}const h=async()=>{const i=t.get();for(i.isModalOpen=!1,t.set(i),e();;){const r=t.get(),p=r.player.hand.find(m=>m.isSelected===!0);if(!p)break;p.isFaceUp=!0,p.isSelected=!1,p.isActive=!0,t.set(r),await x(1e3),await M({...p},"player",["player","hand"]);const f=t.get();p.isFaceUp=!1,d(f.player.hand,f.player.play,p.id),t.set(f),await x(1e3)}s(),await a()},y=()=>{oe();const i=t.get();i.isModalOpen=!1,t.set(i),A()};function A(){var r;const i=t.get();i.storyIndex>=ue.length-1?(i.isModalOpen=!1,i.isStarted=!0,t.set(i),window.methods.advancePhase()):(i.storyIndex=i.storyIndex+1,t.set(i),setTimeout(A,3e3),(r=document.querySelector(".last-line"))==null||r.classList.add("visible"))}const F=async()=>{const i=t.get();i.isModalOpen=!1,i[i.selectedPile],i[i.selectedPile]=[...i[i.selectedPile].reverse()],t.set(i),e(),await x(500),await u(),await x(500),s(),await a()},S=()=>{const i=t.get();i.isModalOpen=!1,t.set(i)};function H(){const i=t.get(),r=i.player.play.length,p=i.opponent.play.length;i.activePlayer==="player"&&r>15&&(i.winner="The Void"),i.activePlayer==="opponent"&&p>15&&(i.winner="You"),i.activePlayer=i.activePlayer==="player"?"opponent":"player",t.set(i)}const se=i=>{if(!l("take"))return;const r=t.get();r.activePlayer!=="opponent"&&(r.selectedPile=i,r.isModalOpen=!0,t.set(r))},k=(i,r)=>{const p=t.get(),f=we(p,i),m=f==null?void 0:f.find(P=>P.id===r);m&&(m.isSelected=!m.isSelected,t.set(p))},Y=(i,r,p)=>{const f=t.get(),m=we(f,i);if(!Array.isArray(m)){t.set(f);return}const P=m.findIndex(j=>j.id===r);if(P===-1){t.set(f);return}const[C]=m.splice(P,1),v=p?Math.min(P+1,m.length):Math.max(P-1,0);m.splice(v,0,C),t.set(f)};window.methods={advancePhase:w,submitTakeModal:F,cancelTakeModal:S,submitPlayModal:h,cancelPlayModal:y,setSelected:k,viewPile:se,orderCards:Y}}function nt(){document.addEventListener("keydown",e=>{e.key.toLowerCase()==="m"&&Ze()})}function it(e){document.addEventListener("keydown",s=>{if(s.key.toLowerCase()==="s"){const a=e.get();a.isModalOpen=!1,a.isStarted=!0,a.storyIndex=ue.length,e.set(a),window.methods.advancePhase()}})}
