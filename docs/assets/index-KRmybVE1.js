(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function o(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(t){if(t.ep)return;t.ep=!0;const r=o(t);fetch(t.href,r)}})();const ze=(e,s)=>{let o=structuredClone(e),a=!1;const t=()=>structuredClone(o),r=l=>{s(l),o=l};return a===!1&&(s(e),a=!0),{get:t,set:r}},C=e=>new Promise(s=>setTimeout(s,e)),Se=e=>{for(let s=e.length-1;s>0;s--){const o=Math.floor(Math.random()*(s+1));[e[s],e[o]]=[e[o],e[s]]}return e},ye=e=>e[Math.floor(Math.random()*e.length)],Re=e=>Math.floor(Math.random()*e)+1,ke=(e,s,o={})=>{var h,x;const a=e.getAttribute("d");if(!a)throw new Error(`Element "${id}" has no 'd' attribute`);const t=/-?\d*\.?\d+(?:e[-+]?\d+)?/gi,r=(h=a.match(t))==null?void 0:h.map(Number),l=(x=s.match(t))==null?void 0:x.map(Number);if(!r||!l||r.length!==l.length)throw new Error("Start and target paths must have identical command structure and number count.");const c=o.easing||(P=>.5-.5*Math.cos(Math.PI*P)),p=Math.max(1,o.duration||800);return new Promise(P=>{const E=(A,g,z)=>A+(g-A)*z;let b;function O(A){b??(b=A);const g=Math.min(1,(A-b)/p),z=c(g),u=r.map((v,S)=>E(v,l[S],z)),m=a.replace(t,()=>{const v=u.shift();return Math.abs(v)<1e-6?"0":v.toFixed(3).replace(/\.?0+$/,"")});e.setAttribute("d",m),g<1?requestAnimationFrame(O):P()}requestAnimationFrame(O)})},oe=(e,s)=>{const o=document.querySelectorAll(".upper-brow"),a=e?600:600+Re(200),t=`m-6,0l649,0l0,${s||a}c-119.17,-95.85 -41.92,-306.25 -163.12,-392.89c-104.61,-77.09 -381.27,-13.02 -485.88,-90.11z`;for(let r=0;r<o.length;r++)ke(o[r],t,{duration:200+a*3})},fe=e=>{const s=document.querySelectorAll(".iris"),o=e?"m345.22,45c-188.76,49.98 -199.63,117.3 -216.1,197.88c2.69,140.76 156.4,202.98 220.35,210.12c2.13,0 200.44,-22.44 196.5,-210.12c-5.14,-149.94 -200.76,-197.88 -200.76,-197.88z":"m330.55,45c-23.96,49.98 -25.34,117.3 -27.43,197.88c0.34,140.76 19.85,202.98 27.97,210.12c0.27,0 25.44,-22.44 24.94,-210.12c-0.65,-149.94 -25.48,-197.88 -25.48,-197.88z";for(let a=0;a<s.length;a++)setTimeout(()=>{ke(s[a],o,{duration:500})},2200)},f=(e,s)=>e.filter(o=>o.zone===s).sort((o,a)=>o.zoneOrder-a.zoneOrder).reverse(),F=(e,{size:s=256,cell:o=14,jitter:a=.85}={})=>{const t=s,r=u=>Math.max(0,Math.min(t-1,u)),l=document.createElement("canvas");l.width=l.height=t;const c=l.getContext("2d",{willReadFrequently:!0});function p(u,m){c.clearRect(0,0,t,t),c.textAlign="center",c.textBaseline="middle",c.font=`${t*.78}px ${m}`,c.fillStyle="#000",c.fillText(u,t/2,t/2)}function h(){const u=c.getImageData(0,0,t,t).data;for(let m=3;m<u.length;m+=4)if(u[m]!==0)return!0;return!1}const x=['"Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji",sans-serif','"Segoe UI Emoji","Noto Color Emoji","Apple Color Emoji",sans-serif',"sans-serif"];let P=!1,E=e;for(let u=0;u<3&&!P;u++)p(E,x[u]),P=h(),!P&&u===0&&!/\uFE0F/.test(E)&&(E=e+"️",u--);P||(c.clearRect(0,0,t,t),c.fillStyle="#000",c.fillRect(t*.25,t*.25,t*.5,t*.5));const b=[],O=o*a*.5;for(let u=0;u<=t;u+=o){const m=[];for(let v=0;v<=t;v+=o){const S=v>0&&v<t?(Math.random()*2-1)*O:0,I=u>0&&u<t?(Math.random()*2-1)*O:0;m.push([r(v+S),r(u+I)])}b.push(m)}const A=document.createElement("canvas");A.width=A.height=t;const g=A.getContext("2d");function z(u,m,v){const S=r((u[0]+m[0]+v[0])/3|0),I=r((u[1]+m[1]+v[1])/3|0),R=c.getImageData(S,I,1,1).data;R[3]<1||(g.beginPath(),g.moveTo(u[0],u[1]),g.lineTo(m[0],m[1]),g.lineTo(v[0],v[1]),g.closePath(),g.fillStyle=`rgba(${R[0]},${R[1]},${R[2]},${(R[3]/255).toFixed(3)})`,g.fill())}for(let u=0;u<b.length-1;u++)for(let m=0;m<b[u].length-1;m++){const v=b[u][m],S=b[u][m+1],I=b[u+1][m],R=b[u+1][m+1];Math.random()<.5?(z(v,S,R),z(v,R,I)):(z(v,S,I),z(S,R,I))}return A.toDataURL("image/png")},$=(e,...s)=>e.reduce((o,a,t)=>o+a+(s[t]??""),""),he=(e,s)=>e.map(s).join(""),L=(e,s,o)=>f(e,s).map(o).join(""),xe=(e,s)=>{e.innerHTML=s()},te=["deck","pile1","pile2","pile3"],ae=["takeModal","playerPlay","opponentPlay","active"],K=new Map,Q=new Map;function Fe({containerSelector:e=".card-container",faceUpClass:s="face-up",faceDownClass:o="face-down"}={}){return{startFlip(a){K.clear(),document.querySelectorAll("[data-flip]").forEach(t=>{const r=t.getAttribute("data-flip");if(!r)return;const l=t.getBoundingClientRect();K.set(r,l)})},endFlip(a=200,t){return new Promise(r=>{const l=[];document.querySelectorAll("[data-flip]").forEach(c=>{const p=c.getAttribute("data-flip");if(!p)return;const h=K.get(p);if(!h)return;const x=c.getBoundingClientRect(),P=h.left-x.left,E=h.top-x.top;(P||E)&&(c.style.transform=`translate(${P}px, ${E}px)`,l.push(c));const b=t.cards.find(z=>z.id===parseInt(p,10)),O=b==null?void 0:b.zone,A=Q.get(p),g=c.querySelector(e);g&&(te.includes(A)&&ae.includes(O)?(g.classList.remove(o),g.classList.add(s)):ae.includes(A)&&te.includes(O)&&(g.classList.remove(s),g.classList.add(o))),Q.set(p,O)}),document.querySelectorAll("[data-face]").forEach(c=>{var b;const p=c.getAttribute("data-face");if(!p)return;const h=(b=t.cards.find(O=>O.id===parseInt(p,10)))==null?void 0:b.zone,x=Q.get(p);if(!x)return;const P=["deck","opponentPlay","pile1","pile2","pile3"],E=["takeModal","playerPlay"];h!==x&&(P.includes(x)&&E.includes(h)&&(c.classList.remove(o),c.classList.add(s)),E.includes(x)&&P.includes(h)&&(c.classList.remove(s),c.classList.add(o))),Q.set(p,h)}),requestAnimationFrame(()=>{l.forEach(c=>{c.style.transition=`transform ${a}ms ease`,c.style.transform=""}),setTimeout(()=>{l.forEach(c=>{c.style.transition=""}),K.clear(),r()},a)})})}}}const $e=(e,s)=>{if(console.log(s),typeof s!="number"||s<=0){const o=e.get(),a=o.activePlayer==="player"?"player":"opponent";let t=0;for(let r=0;r<o[a].play.length;r++)o[a].play[r].types.includes(s)&&o[a].play[r].isExhausted===!1&&t++;return t}return s},Ae=async(e,s)=>{for(let o=0;o<e&&await s(o)!==!1;o++);};async function _(e,s,o){const a=$e(e,o);await Ae(a,async()=>{const t=e.get(),r=f(t.cards,"deck"),l=r[r.length-1];if(!l)return!1;l.zone=`${s}Play`,e.set(t),await C(1e3)})}async function me(e,s,o){const a=$e(e,o);await Ae(a,async()=>{const t=e.get(),r=`${s}Play`,l=f(t.cards,r);if(!l.length)return!1;const p=l.find(h=>h.isExhausted)??l[l.length-1];if(!p)return!1;p.zone="deck",p.isExhausted=!1,e.set(t),await C(1e3)})}const ve={floodOpponent$Time:async(e,s,o)=>{await _(e,s==="player"?"opponent":"player",o)},floodAllPlayers$Time:async(e,s,o)=>{await _(e,"player",o),await _(e,"opponent",o)},return$Time:async(e,s,o)=>{await me(e,s,o)},forEach$InYourPlayAreaFloodYourOpponent:async(e,s,o)=>{await _(e,s==="player"?"opponent":"player",o)},forEach$InYourPlayAreaReturnACard:async(e,s,o)=>{await me(e,s,o)},turn2$OfYourOpponentsCardsFaceDown:async(e,s,o)=>{await C(1e3);const a=e.get();let r=a.activePlayer==="opponent"?f(a.cards,"playerPlay"):f(a.cards,"opponentPlay"),l=0;for(let c=0;c<r.length;c++){const p=r[c];if(!p.isExhausted&&p.types.includes(o)&&(p.isExhausted=!0,l++),l>=2)break}e.set(a)},ifYouHave5OrMore$CardsYouWinTheGame:async(e,s,o)=>{await C(1e3);const a=e.get(),t=a.activePlayer;let r=t==="player"?f(a.cards,"playerPlay"):f(a.cards,"opponentPlay"),l=0;r.forEach(c=>{!c.isExhausted&&c.types.includes(o)&&l++}),l>=5&&(a.winner=t==="player"?"You":"The Void"),e.set(a)},turnAllYour$CardsFaceUp:async(e,s,o)=>{await C(1e3);const a=e.get();let t=activePlayer==="player"?f(a.cards,"playerPlay"):f(a.cards,"opponentPlay");for(let r=0;r<t.length;r++){const l=t[r];l.isExhausted&&l.types.includes(o)&&(l.isExhausted=!1)}e.set(a)},returnAllExhaustedCards:async(e,s,o)=>{await C(1e3);const a=e.get();let t=activePlayer==="player"?f(a.cards,"playerPlay"):f(a.cards,"opponentPlay");const r=f(a.cards,"deck");for(let l=0;l<t.length;l++){const c=t[l];c.isExhausted&&(c.zone=r,c.zoneOrder=r[r.length-1].zoneOrder+1)}e.set(a)},unexhaustAllYourExhaustedCards:async(e,s,o)=>{await C(1e3);const a=e.get();let t=activePlayer==="player"?f(a.cards,"playerPlay"):f(a.cards,"opponentPlay");for(let r=0;r<t.length;r++){const l=t[r];l.isExhausted&&(l.isExhausted=!1)}e.set(a)},remianingCardsInPileGoToYourPlayArea:async(e,s,o)=>{await C(1e3);const a=e.get();a.isPileToPlay="next",e.set(a)},exhaust$OfYourOpponentsUnexhaustedCardsAtRandom:async(e,s,o)=>{await C(1e3);const a=e.get();let r=a.activePlayer==="opponent"?f(a.cards,"playerPlay"):f(a.cards,"opponentPlay");const l=r.map(h=>h.id),c=shuffleArray(l);let p=0;for(let h=0;h<c.length;h++){const x=r.find(P=>P.id===c[h]);if(x.isExhausted||(x.isExhausted=!0,p++),p>=o)break}e.set(a)}},J=["🦀","🥩","🧨","🔥","💃","💄","🌋","🌶️","🍅","🥩","🧨","🎈","🎉","📕","☎️","🚗","🚒","🛑","🦑","🧯","🦀","🦞","🦐","🧣","🦊","🦁","🪔","🛢️","🧱"],ie=["🧊","🌊","🌀","❄️","☃️","🌌","🪐","⭐","🌠","🧞","🦋","🐬","🐟","🐳","🐢","🐍","🐸","🦖","🌴","🌳","🍀","🌿","🍏","🥝","🥒","🥦","🫐","🧵","👖","📘","💎","🔵","🔷","🟩","🟦","🕺"],le=["🤍","🖤","🤎","🪨","🏺","🪵","🪑","⚱️","⚙️","📦","📜","📄","📓","📰","💼","🥋","🥔","🍞","🥖","🪙","💰","🛋️","🪞","🧳","🏚️","⚫","⚪","📎","🧂","🗿","🛡️"],ce=["c","c","c","c","c","c","c","c","c","u","u","u","u","r"],X={blank:{name:"Eclipse Void",types:["rift","echo","omen"],abilityFunct:[],abilityRule:[],cardArt:F(J[8],{size:100,cell:10})},cRift:{name:"Stellar Crypt",types:["rift"],abilityFunct:["floodOpponent$Time:1"],abilityRule:["Flood your opponent 1 time."],cardArt:F(J[0],{size:100,cell:10})},uRift:{name:"Grave Haunt",types:["rift"],abilityFunct:["floodOpponent$Time:2"],abilityRule:["Flood your opponent 2 times."],cardArt:F(J[1],{size:100,cell:10})},rRift:{name:"Chasm Infernal",types:["rift"],abilityFunct:["floodAllPlayers$Time:2"],abilityRule:["Flood all players 2 times."],cardArt:F(J[2],{size:100,cell:10})},cEcho:{name:"Ethereal Nebula",types:["echo"],abilityFunct:["return$Time:1"],abilityRule:["Return a card 1 time."],cardArt:F(ie[0],{size:100,cell:10})},uEcho:{name:"Cosmic Lunar",types:["echo"],abilityFunct:["returnAllExhaustedCards"],abilityRule:["Return all your exhuasted cards."],cardArt:F(ie[1],{size:100,cell:10})},rEcho:{name:"Umbral Aster",types:["echo"],abilityFunct:["unexhaustAllYourExhaustedCards"],abilityRule:["Unexhaust all your exhuasted cards."],cardArt:F(ie[2],{size:100,cell:10})},cOmen:{name:"Orbit Crypt",types:["omen"],abilityFunct:["remianingCardsInPileGoToYourPlayArea"],abilityRule:["The remaining cards in this pile got to your play area."],cardArt:F(le[0],{size:100,cell:10})},uOmen:{name:"Nebula Specter",types:["omen"],abilityFunct:["exhaust$OfYourOpponentsUnexhaustedCardsAtRandom:2"],abilityRule:["Exhaust 2 random unexhausted cards in your opponents play area."],cardArt:F(le[1],{size:100,cell:10})},rOmen:{name:"Shadow Singularity",types:["omen"],abilityFunct:["exhaust$OfYourOpponentsUnexhaustedCardsAtRandom:4"],abilityRule:["Exhaust 4 random unexhausted cards in your opponents play area."],cardArt:F(le[2],{size:100,cell:10})}},ee=(e,s)=>({id:s,zoneOrder:0,zone:"deck",isSelected:!1,isActive:!1,isExhausted:!1,...e}),Ie=e=>{const s=[];for(let a=0;a<5;a++){const t=X.blank;s.push(ee(t,s.length+1))}return ce.forEach(a=>{const t=X[a+"Rift"];s.push(ee(t,s.length+1))}),ce.forEach(a=>{const t=X[a+"Echo"];s.push(ee(t,s.length+1))}),ce.forEach(a=>{const t=X[a+"Omen"];s.push(ee(t,s.length+1))}),Se(s).map((a,t)=>(a.zoneOrder=t,a))},Ee=["deal","take","end"],ue=Ie();console.log(ue);const Le=()=>new Promise(e=>{e({isIntroSkipped:!1,isUiHidden:!0,storyIndex:0,isStarted:!1,isPhaseButtonDisabled:!0,isPileToPlay:"deck",winner:void 0,activePlayer:"player",currentPhase:void 0,phases:Ee,isModalOpen:!1,ui:{},deck:[...ue],cards:[...ue],selectedPile:"pile1",pile1:[],pile2:[],pile3:[],player:{id:1,hand:[],play:[],isComputer:!1},opponent:{id:2,hand:[],play:[],isComputer:!0}})}),pe=["","Well, well, well. Look what we have here?","A small flicker of light at dusk.","Delicious. I so rarely get guests","I so rarely get any guests... guests.","It's all so terrIBLY BORING I JUST WANT...","...I'm sorry I forget myself, forgot myself.","Welcome, you who stands at the edge twilight.","Come, sit with me and play a game.","It tastes like cards, and you wager yourself.","The night is almost here... you get the first play."],je=F("🌌",{size:500,cell:15}),ge=new Map;function j(e,s,o=!1,a){var p,h;let t=e.types[0];e.types.length>1&&(t="multi");const r=ge.get(e.id),l=e.zone;let c="face-down";return r&&l&&(ae.includes(r)&&ae.includes(l)?c="face-up":te.includes(r)&&te.includes(l)&&(c="face-down")),ge.set(e.id,l),$`
    <div class="card-wrapper ${e.zone==="active"?"active-card":""} ${e.isExhausted?"played":""}" ${s?"":"data-flip="+e.id}>
      <div class="card-container ${c}" data-face="${e.id}">
        <div class="card ${a?"pulse-border":""}">
          <div class="card-face front ${t}">
            <div class="card-name">${e.name}</div>
            <img class="card-image" src="${e.cardArt}">
            ${e.isExhausted?"":$`<div class="card-type">${(p=e.types)==null?void 0:p.join(" - ")}</div>`}
            <div class="card-rules">${(h=e.abilityRule)==null?void 0:h.join(`
`)}</div>
          </div>

          <div class="back">
          <img class="back-pattern" src="${je}">
          </div>
        </div>
      </div>
    </div>
  `}function qe(e){return $`
        <div class="dialog">
            <div class="game-rules-wrapper">
                <div class="flex-col">
                    <h3>Rules</h3>
                    <div>Goal: If a player ends their turn with 15 cards in their play area they lose the game.</div>
                    <div>m Key: Turn on music - s Key: Skip intro</div>
                    <div>
                        <ol>
                            <li>Each turn a card is dealt to each of 3 piles.</li>
                            <li>Then the active player chooses a pulsing blue pile.</li>
                            <li>All cards from the chosen pile are played in the chosen numerical order.</li>
                            <li>Played cards go to the bottom of the deck.</li>
                            <li>If the active player doesn't have 15 or more cards in their play area their opponent goes and the above steps are repeated.</li>
                        </ol>
                    </div>
                    <div>
                    <h3>Terms</h3>
                    <ul>
                        <li>Flood: Force your opponent to draw a card and put it in their play area.</li>
                        <li>Exhausted: Cards can become exhausted in play areas. They are no longer counted by card abilities but they are counted towards the 15 cards that cause you to lose the game.</li>
                        <li>Return: Return a card from you play area to the bottom of the deck. Exhausted cards are returned first followed by the last card you played.</li>
                    </ul>
                    </div>
                    <div><button class="jagged" onclick="methods.cancelPlayModal()">Start the Game</button></div>
                </div>
            </div>
        </div>
  `}function Ne(e){let s=f(e.cards,"playerPlay").filter(t=>t.types.includes("rift")),o=f(e.cards,"playerPlay").filter(t=>t.types.includes("echo")),a=f(e.cards,"playerPlay").filter(t=>t.types.includes("omen"));return $`
        <div class="dialog">
            <div>
                <div>Select this pile of cards by clicking the take button. Cards resolve in numerical order.</div>
                <div>Your play area has ${s.length} rifts, ${o.length} echos, and ${a.length} omens</div>
            </div>
            <div class="flex-column">
                <div class="flex-cards">
                ${L(e.cards,"takeModal",(t,r)=>{var l;return $`
                        <div>
                            <div class="deck-card-wrapper">${j(t,!0,!0,!0)}</div>
                        ${((l=f(e.cards,"takeModal"))==null?void 0:l.length)>1?$`<div class="number-buttons-wrapper"><button class="jagged" onclick="methods.orderCards(${t.id}, false)">⬅</button><div class="number">${r+1}</div><button class="jagged" onclick="methods.orderCards(${t.id}, true)">⮕</button></div>`:""}
                        </div>`})}
                </div>

            </div>
            <div class="flex-row dialog-ui">
                <button class="jagged" onclick="methods.cancelTakeModal()">Close</button>
                <button class="jagged" onclick="methods.submitTakeModal()">Take & Pass</button>
            </div>
        </div>
  `}function Ye(e){const s=Ee[e.currentPhase],a=(e.currentPhase?["play","end"]:["take","end"]).includes(s)?e.activePlayer==="player"?"opponent":"player":e.activePlayer;return $`
    <div class="${e.isStarted?"hidden":""}" id="story-wrapper">
        ${he(pe,(t,r)=>r>e.storyIndex?null:r===e.storyIndex?$`<div class="last-line">${t}</div>`:$`<div>${t}</div>`)}
    </div>
    <div class="${e.isStarted?"":"ui-wrapper"}">
        <div>
            <div class="phases-wrapper ${a!=="player"?"void-phase jagged":""}">
                ${a==="player"?"YOUR TURN: ":"VOID'S TURN: "}
                ${he(e.phases,(t,r)=>$`<div class="phase-wrapper ${e.currentPhase===r?"active":""}">${t.toUpperCase()}</div>`)}
            </div>
            <div class="game-area-wrapper">
                <div class="deck-dealt-wrapper">
                    <div class="deck-wrapper">${L(e.cards,"deck",(t,r)=>$`<div class="deck-card-wrapper" style="${"bottom:"+Math.floor(r/3)+"px;right:"+Math.floor(r/6)+"px"}">${j(t,!1,!1,!1)}</div>`)}</div>
                    <div class="pile-wrapper pile-1-wrapper">${L(e.cards,"pile1",(t,r)=>$`<div onclick="methods.viewPile('pile1')" class="pile" style="${"bottom:"+r*2+"px;right:"+r*2+"px"}">${j(t,!1,!1,!1)}</div>`)}</div>
                    <div class="pile-wrapper pile-2-wrapper">${L(e.cards,"pile2",(t,r)=>$`<div onclick="methods.viewPile('pile2')" class="pile" style="${"bottom:"+r*2+"px;right:"+r*2+"px"}">${j(t,!1,!1,!1)}</div>`)}</div>
                    <div class="pile-wrapper pile-3-wrapper">${L(e.cards,"pile3",(t,r)=>$`<div onclick="methods.viewPile('pile3')" class="pile" style="${"bottom:"+r*2+"px;right:"+r*2+"px"}">${j(t,!1,!1,!1)}</div>`)}</div>
                </div>
                
            </div>

        </div>
        <div class="flex-row-top">
            <div class="play-area-wrapper area-wrappers play-area-min-height">
                <div class="play-area-header">⚪ YOUR PLAY AREA (${e.player.play.length+e.player.hand.length})</div>
                <div class="flex-cards">
                ${L(e.cards,"playerPlay",(t,r)=>$`<div>${j(t,!1,!0,!1)}</div>`)}
                </div>
            </div>

            <div class="play-area-wrapper area-wrappers play-area-min-height">
                <div class="play-area-header">⚫ THE VOIDS'S PLAY AREA (${e.opponent.play.length+e.opponent.hand.length})</div>
                <div class="flex-cards">
                    ${L(e.cards,"opponentPlay",(t,r)=>$`<div class="pile">${j(t,!1,!0,!1)}</div>`)}
                </div>
            </div>    
        
        </div>
        </div>  
        <div class="dialog-wrapper ${e.isModalOpen||e.storyIndex===0?"":"hidden"}">
            ${e.storyIndex===0?qe():null}
            ${e.currentPhase===1&&e.isStarted===!0?Ne(e):null}
        </div>
        <div class="active-card-wrapper flex-row">
            ${L(e.cards,"active",(t,r)=>$`<div class="pile">${j(t,!1,!0,!1)}</div>`)}
        </div>
 
  `}const Be=F("😶",{size:500,cell:20}),we=e=>$`
        <div class="eye-wrapper" ${e?"style='transform: scaleX(-1)'":""}>
            <img class="eye-background" src="${Be}">
            <svg class="eye-layer" viewBox="0 0 622 500" preserveAspectRatio="xMaxYMin">
                <g class="layer">
                <path class="upper-brow" d="m-6,0l649,0l0,890c-119.17,-95.85 -41.92,-306.25 -163.12,-392.89c-104.61,-77.09 -381.27,-13.02 -485.88,-90.11z" fill="#000000" id="svg_16" stroke="#000000" stroke-width="0"/>
                <path d="m-3,-1c0.68,161 1.35,322 2.03,483l642.97,0c-94.8,-70.22 -336.89,9.59 -431.69,-60.63c-120.2,-90.78 -93.11,-331.59 -213.31,-422.37z" fill="#000000" id="svg_17" stroke="#000000" stroke-width="0"/>
                <path class="iris" d="m330.55,45c-23.96,49.98 -25.34,117.3 -27.43,197.88c0.34,140.76 19.85,202.98 27.97,210.12c0.27,0 25.44,-22.44 24.94,-210.12c-0.65,-149.94 -25.48,-197.88 -25.48,-197.88z" fill="#000000" stroke="#000000" stroke-width="0"/>
                </g>
            </svg>
        </div>
    `,De=()=>$`
        <div class="eyes-wrapper">
            ${we(!1)}
            ${we(!0)}
        </div>
    `,Ge=(e,s,o)=>{const a=typeof s=="object"&&s?s:{wave:typeof s=="string"?s:"sine",musicLength:void 0},t=a.wave||"sine",r=a.musicLength??.1,l=a.transposeOctaves??-2,c=a.transposeSemitones??0,p=a.baseHz??440,h=a.baseCharCode??105,x=a.filterCutoff??450,P=a.filterQ??10,E=a.subLevel??.35,b=a.subOctaves??1,O=a.gain??.45,A=a.attack??.01,g=a.decay??.12,z=a.sustain??.2,u=a.release??.3,m=a.vibratoRate??5,v=a.vibratoDepth??12,S=a.delayTime??.23,I=a.delayFeedback??.33,R=a.delayWet??.25,V={5:.4,4:.3,3:.2,2:.1,1:.05},n=[...Object.keys(V),"-"];window.AudioContext=window.AudioContext||window.webkitAudioContext;const i=new AudioContext,d=i.createGain();d.gain.value=.9,d.connect(i.destination);const y=i.createDelay(1.5);y.delayTime.value=S;const w=i.createGain();w.gain.value=I;const k=i.createGain();k.gain.value=R,y.connect(w),w.connect(y),y.connect(k),k.connect(d);for(let M=0;M<e.length;M++){const Z=e[M],D=e[M+1],N=isNaN(D)?r:V[D];if(!Z||n.includes(Z))continue;const T=i.currentTime+M*N+.3,H=T+N,Te=e.charCodeAt(M)-h+l*12+c,se=p*Math.pow(2,Te/12),Y=i.createOscillator();Y.type=t,Y.frequency.setValueAtTime(se,T);const G=i.createOscillator();G.type=t==="square"?"sine":t;const Ce=se/Math.pow(2,b);G.frequency.setValueAtTime(Ce,T);const ne=i.createGain();ne.gain.value=E;const B=i.createBiquadFilter();B.type="lowpass",B.frequency.setValueAtTime(x,T),B.Q.setValueAtTime(P,T);const q=i.createGain();if(q.gain.setValueAtTime(1e-4,T),q.gain.linearRampToValueAtTime(O,T+A),q.gain.linearRampToValueAtTime(O*z,T+A+g),q.gain.setTargetAtTime(1e-4,Math.max(T,H-u),.15),v>0){const W=i.createOscillator(),re=i.createGain();W.frequency.setValueAtTime(m,T);const Oe=Me=>Me*(Math.pow(2,v/1200)-1);re.gain.value=Oe(se),W.connect(re),re.connect(Y.frequency),W.start(T),W.stop(H+.1)}Y.connect(B),G.connect(ne),ne.connect(B),B.connect(q),q.connect(d),q.connect(y),Y.start(T),G.start(T),Y.stop(H+.05),G.stop(H+.05)}},Ue=()=>{const e=["m5","k5","h5","o5","g5","k3","h3","m3","k2","h2","m4"],s=["-m5-k5-h5-m5-","-m5-k5-h5-k5-","-o5-m5-k5-h5-","-h5-g5-k5-h5--","-k3-h3-m5--k3-h3-m5--","-m5-m5-k5-h5-m5--","-a5-h5-g5-d5-c5-a5-a5-","-a5-h5-g5-d5-c5-k25-k25-","-o5-j5-k5-g5-h5-h5-c5-","-m5-g5-j5-c5-h3"];let o="";for(let a=0;a<200;a++){const t=Math.random()>.7?"---":"--",r=Math.random()>.9?ye(e):ye(s);o+=r+t}Ge(o,{wave:"sawtooth",musicLength:.4,transposeOctaves:-3,filterCutoff:320,filterQ:14,subLevel:.45,subOctaves:2,attack:.03,decay:.2,sustain:.35,release:.6,vibratoRate:4,vibratoDepth:14,delayTime:.38,delayFeedback:.38,delayWet:.22,gain:.2})},Pe=Fe();let be=!1,U=0,de=!1;const Ve=(e,s)=>s.length>1?e[s[0]][s[1]]:e[s[0]],Ze=document.querySelector("#app"),He=document.querySelector("#eyes"),We=async e=>{Pe.startFlip(e),xe(Ze,()=>Ye(e)),Pe.endFlip(500,e)};setTimeout(()=>{Ke()},200);async function Ke(){const e=()=>{U++},s=()=>{U=Math.max(0,U-1),U===0&&de&&(de=!1,P())},o=async()=>{if(U>0){de=!0;return}await P()};if(be)return;be=!0;const a=await Le(),t=ze(a,We);Qe(),_e(t),xe(He,()=>De());const r=()=>{const n=t.get();return n.phases[n.currentPhase??0]},l=n=>r()===n,c=n=>{const i=t.get(),y=f(i.cards,"deck")[0].zoneOrder,w=i.cards.find(k=>k.id===n);if(i.isPileToPlay==="play"){const k=i.activePlayer==="player"?"playerPlay":"opponentPlay";w.zone=k}else w.zone="deck",w.zoneOrder=y+1;i.isPileToPlay==="next"&&(i.isPileToPlay="play"),t.set(i)},p=async()=>{for(let n=1;n<=3;n++){const i=t.get(),d=f(i.cards,"deck");console.log(d);const y=d[d.length-1];if(!y)break;y.zone=`pile${n}`,t.set(i)}},h=async(n,i,d)=>{if(!n||!Array.isArray(n.abilityFunct))return;e();for(let M=0;M<n.abilityFunct.length;M++){const Z=n.abilityFunct[M],[D,N]=String(Z).split(":");let T=N?parseInt(N,10):0;Number.isNaN(T)&&(T=N),ve[D]&&await ve[D](t,i,T)}const y=t.get();let w;d.length>1?w=y[d[0]][d[1]]:w=y[d[0]];const k=w.find(M=>M.id===n.id);if(k){const M=f(y.cards,"deck");k.zone="deck",k.zoneOrder=M[M.length-1].zoneOrder+1,t.set(y)}s()},x=()=>{const n=t.get(),i=n.currentPhase===void 0||n.currentPhase+1>=n.phases.length?0:n.currentPhase+1;return n.currentPhase=i,t.set(n),n.phases[i]};async function P(){const n=t.get();if(n.winner){alert(`${n.winner} has won the game`);return}const i=x();n.activePlayer==="player"?await b(i):await O(i)}const E=n=>{const i=t.get();i.isPhaseButtonDisabled=n,t.set(i)};async function b(n){E(!0),n==="deal"&&(oe(!0),await await p(),await C(500),await o()),n!=="take"&&n==="end"&&(S(),await o())}async function O(n){E(!0),n==="deal"&&(fe(!0),await p(),await C(500),await o()),n==="take"&&(await A(),await C(3e3),E(!1)),n==="end"&&(fe(!1),S(),await o())}async function A(){e(),oe();const n=t.get(),i=f(n.cards,"pile1").length,d=f(n.cards,"pile2").length,y=f(n.cards,"pile3").length;i>=d&&i>=y?n.selectedPile="pile1":d>=i&&d>=y?n.selectedPile="pile2":n.selectedPile="pile3",t.set(n),await C(200),await g(),s(),await o()}async function g(){for(;;){const i=t.get(),d=f(i.cards,i.selectedPile).reverse();if(!Array.isArray(d)||d.length===0)break;const y=d[d.length-1];if(!y)break;y.isFaceUp=!0,y.zone="active",t.set(i),await C(2e3),await h({...y},i.activePlayer,[i.selectedPile]),c(y.id),await C(1e3)}const n=t.get();n.isPileToPlay="deck",n.player.play=n.player.play.sort(i=>i.isExhausted),n.opponent.play=n.opponent.play.sort(i=>i.isExhausted),t.set(n)}const z=()=>{oe(!1,750);const n=t.get();n.isModalOpen=!1,t.set(n),u()};function u(){var i;const n=t.get();n.storyIndex>=pe.length-1?(n.isModalOpen=!1,n.isStarted=!0,t.set(n),window.methods.advancePhase()):(n.storyIndex=n.storyIndex+1,t.set(n),setTimeout(u,3e3),(i=document.querySelector(".last-line"))==null||i.classList.add("visible"))}const m=async()=>{const n=t.get();n.isModalOpen=!1,f(n.cards,"takeModal").forEach(d=>d.zone=n.selectedPile),t.set(n),e(),await C(500),await g(),await C(500),s(),await o()},v=()=>{if(!l("take"))return;const n=t.get();if(n.activePlayer==="opponent")return;const i=f(n.cards,"takeModal");n.isModalOpen=!1,i.forEach(d=>{console.log(d.zone),d.zone=n.selectedPile,console.log(d.zone)}),t.set(n)};function S(){const n=t.get(),i=f(n.cards,"playerPlay").length,d=f(n.cards,"opponentPlay").length;n.activePlayer==="player"&&i>15&&(n.winner="The Void"),n.activePlayer==="opponent"&&d>15&&(n.winner="You"),n.activePlayer=n.activePlayer==="player"?"opponent":"player",t.set(n)}const I=n=>{if(!l("take"))return;const i=t.get();if(i.activePlayer==="opponent")return;const d=f(i.cards,n);i.selectedPile=n,i.isModalOpen=!0,d.forEach(y=>{y.zone="takeModal"}),t.set(i)},R=(n,i)=>{const d=t.get(),y=Ve(d,n),w=y==null?void 0:y.find(k=>k.id===i);w&&(w.isSelected=!w.isSelected,t.set(d))},V=(n,i)=>{const d=t.get(),y=f(d.cards,"takeModal");y.forEach((w,k)=>{w.id===n?w.zoneOrder=i?k+1.5:k-.5:w.zoneOrder=k}),y.sort((w,k)=>w.zoneOrder-k.zoneOrder).reverse().forEach((w,k)=>{w.zoneOrder=k+1}),t.set(d)};window.methods={advancePhase:P,submitTakeModal:m,cancelTakeModal:v,cancelPlayModal:z,setSelected:R,viewPile:I,orderCards:V}}function Qe(){document.addEventListener("keydown",e=>{e.key.toLowerCase()==="m"&&Ue()})}function _e(e){document.addEventListener("keydown",s=>{if(s.key.toLowerCase()==="s"){const o=e.get();o.isModalOpen=!1,o.isStarted=!0,o.storyIndex=pe.length,e.set(o),window.methods.advancePhase()}})}
