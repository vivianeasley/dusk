(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function r(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(e){if(e.ep)return;e.ep=!0;const n=r(e);fetch(e.href,n)}})();const Me=(t,a)=>{let r=structuredClone(t),o=!1;const e=()=>structuredClone(r),n=l=>{a(l),r=l};return o===!1&&(a(t),o=!0),{get:e,set:n}},S=t=>new Promise(a=>setTimeout(a,t)),ue=t=>{for(let a=t.length-1;a>0;a--){const r=Math.floor(Math.random()*(a+1));[t[a],t[r]]=[t[r],t[a]]}return t},fe=t=>t[Math.floor(Math.random()*t.length)],Se=t=>Math.floor(Math.random()*t)+1,ke=(t,a,r={})=>{var h,w;const o=t.getAttribute("d");if(!o)throw new Error(`Element "${id}" has no 'd' attribute`);const e=/-?\d*\.?\d+(?:e[-+]?\d+)?/gi,n=(h=o.match(e))==null?void 0:h.map(Number),l=(w=a.match(e))==null?void 0:w.map(Number);if(!n||!l||n.length!==l.length)throw new Error("Start and target paths must have identical command structure and number count.");const c=r.easing||(k=>.5-.5*Math.cos(Math.PI*k)),f=Math.max(1,r.duration||800);return new Promise(k=>{const C=(A,b,O)=>A+(b-A)*O;let $;function z(A){$??($=A);const b=Math.min(1,(A-$)/f),O=c(b),u=n.map((v,M)=>C(v,l[M],O)),m=o.replace(e,()=>{const v=u.shift();return Math.abs(v)<1e-6?"0":v.toFixed(3).replace(/\.?0+$/,"")});t.setAttribute("d",m),b<1?requestAnimationFrame(z):k()}requestAnimationFrame(z)})},ie=(t,a)=>{const r=document.querySelectorAll(".upper-brow"),o=t?600:600+Se(200),e=`m-6,0l649,0l0,${a||o}c-119.17,-95.85 -41.92,-306.25 -163.12,-392.89c-104.61,-77.09 -381.27,-13.02 -485.88,-90.11z`;for(let n=0;n<r.length;n++)ke(r[n],e,{duration:200+o*3})},ye=t=>{const a=document.querySelectorAll(".iris"),r=t?"m345.22,45c-188.76,49.98 -199.63,117.3 -216.1,197.88c2.69,140.76 156.4,202.98 220.35,210.12c2.13,0 200.44,-22.44 196.5,-210.12c-5.14,-149.94 -200.76,-197.88 -200.76,-197.88z":"m330.55,45c-23.96,49.98 -25.34,117.3 -27.43,197.88c0.34,140.76 19.85,202.98 27.97,210.12c0.27,0 25.44,-22.44 24.94,-210.12c-0.65,-149.94 -25.48,-197.88 -25.48,-197.88z";for(let o=0;o<a.length;o++)setTimeout(()=>{ke(a[o],r,{duration:500})},2200)},y=(t,a)=>t.filter(r=>r.zone===a).sort((r,o)=>r.zoneOrder-o.zoneOrder).reverse(),I=(t,{size:a=256,cell:r=14,jitter:o=.85}={})=>{const e=a,n=u=>Math.max(0,Math.min(e-1,u)),l=document.createElement("canvas");l.width=l.height=e;const c=l.getContext("2d",{willReadFrequently:!0});function f(u,m){c.clearRect(0,0,e,e),c.textAlign="center",c.textBaseline="middle",c.font=`${e*.78}px ${m}`,c.fillStyle="#000",c.fillText(u,e/2,e/2)}function h(){const u=c.getImageData(0,0,e,e).data;for(let m=3;m<u.length;m+=4)if(u[m]!==0)return!0;return!1}const w=['"Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji",sans-serif','"Segoe UI Emoji","Noto Color Emoji","Apple Color Emoji",sans-serif',"sans-serif"];let k=!1,C=t;for(let u=0;u<3&&!k;u++)f(C,w[u]),k=h(),!k&&u===0&&!/\uFE0F/.test(C)&&(C=t+"️",u--);k||(c.clearRect(0,0,e,e),c.fillStyle="#000",c.fillRect(e*.25,e*.25,e*.5,e*.5));const $=[],z=r*o*.5;for(let u=0;u<=e;u+=r){const m=[];for(let v=0;v<=e;v+=r){const M=v>0&&v<e?(Math.random()*2-1)*z:0,L=u>0&&u<e?(Math.random()*2-1)*z:0;m.push([n(v+M),n(u+L)])}$.push(m)}const A=document.createElement("canvas");A.width=A.height=e;const b=A.getContext("2d");function O(u,m,v){const M=n((u[0]+m[0]+v[0])/3|0),L=n((u[1]+m[1]+v[1])/3|0),R=c.getImageData(M,L,1,1).data;R[3]<1||(b.beginPath(),b.moveTo(u[0],u[1]),b.lineTo(m[0],m[1]),b.lineTo(v[0],v[1]),b.closePath(),b.fillStyle=`rgba(${R[0]},${R[1]},${R[2]},${(R[3]/255).toFixed(3)})`,b.fill())}for(let u=0;u<$.length-1;u++)for(let m=0;m<$[u].length-1;m++){const v=$[u][m],M=$[u][m+1],L=$[u+1][m],R=$[u+1][m+1];Math.random()<.5?(O(v,M,R),O(v,R,L)):(O(v,M,L),O(M,R,L))}return A.toDataURL("image/png")},x=(t,...a)=>t.reduce((r,o,e)=>r+o+(a[e]??""),""),he=(t,a)=>t.map(a).join(""),G=(t,a,r)=>y(t,a).map(r).join(""),xe=(t,a)=>{t.innerHTML=a()},W=["🦀","🥩","🧨","🔥","💃","💄","🌋","🌶️","🍅","🥩","🧨","🎈","🎉","📕","☎️","🚗","🚒","🛑","🦑","🧯","🦀","🦞","🦐","🧣","🦊","🦁","🪔","🛢️","🧱"],ae=["🧊","🌊","🌀","❄️","☃️","🌌","🪐","⭐","🌠","🧞","🦋","🐬","🐟","🐳","🐢","🐍","🐸","🦖","🌴","🌳","🍀","🌿","🍏","🥝","🥒","🥦","🫐","🧵","👖","📘","💎","🔵","🔷","🟩","🟦","🕺"],se=["🤍","🖤","🤎","🪨","🏺","🪵","🪑","⚱️","⚙️","📦","📜","📄","📓","📰","💼","🥋","🥔","🍞","🥖","🪙","💰","🛋️","🪞","🧳","🏚️","⚫","⚪","📎","🧂","🗿","🛡️"],le=["c","c","c","c","c","c","c","c","c","u","u","u","u","r"],Re=["rift","echo","omen"],me=(t,a)=>{let r=se[10];return t==="rift"&&(r=W[11]),t==="echo"&&(r=ae[12]),{name:`${String(t).charAt(0).toUpperCase()+String(t).slice(1)} Alignment`,types:[t],zone:a+"Goal",abilityFunct:[],abilityRule:[`At the end of your turn if you have 10 or more other ${t} cards in your play area you win.`],cardArt:I(r,{size:100,cell:10})}},J={blank:{name:"Eclipse Void",types:["rift","echo","omen"],abilityFunct:[],abilityRule:[],cardArt:I(W[8],{size:100,cell:10})},cRift:{name:"Stellar Crypt",types:["rift"],abilityFunct:["floodOpponent$Time:2"],abilityRule:["Flood your opponent 2 time."],cardArt:I(W[0],{size:100,cell:10})},uRift:{name:"Grave Haunt",types:["rift"],abilityFunct:["floodOpponent$Time:3"],abilityRule:["Flood your opponent 3 times."],cardArt:I(W[1],{size:100,cell:10})},rRift:{name:"Chasm Infernal",types:["rift"],abilityFunct:["floodAllPlayers$Time:2"],abilityRule:["Flood all players 2 times."],cardArt:I(W[2],{size:100,cell:10})},cEcho:{name:"Ethereal Nebula",types:["echo"],abilityFunct:["return$Time:1"],abilityRule:["Return a card 1 time."],cardArt:I(ae[0],{size:100,cell:10})},uEcho:{name:"Cosmic Lunar",types:["echo"],abilityFunct:["returnAllExhaustedCards"],abilityRule:["Return all your exhuasted cards."],cardArt:I(ae[1],{size:100,cell:10})},rEcho:{name:"Umbral Aster",types:["echo"],abilityFunct:["unexhaustAllYourExhaustedCards"],abilityRule:["Unexhaust all your exhuasted cards."],cardArt:I(ae[2],{size:100,cell:10})},cOmen:{name:"Orbit Crypt",types:["omen"],abilityFunct:["remianingCardsInPileGoToYourPlayArea"],abilityRule:["The remaining cards in this pile go to your play area."],cardArt:I(se[0],{size:100,cell:10})},uOmen:{name:"Nebula Specter",types:["omen"],abilityFunct:["exhaust$OfYourOpponentsUnexhaustedCardsAtRandom:2"],abilityRule:["Exhaust 2 random unexhausted cards in your opponents play area."],cardArt:I(se[1],{size:100,cell:10})},rOmen:{name:"Shadow Singularity",types:["omen"],abilityFunct:["exhaust$OfYourOpponentsUnexhaustedCardsAtRandom:4"],abilityRule:["Exhaust 4 random unexhausted cards in your opponents play area."],cardArt:I(se[2],{size:100,cell:10})}},X=(t,a)=>({id:a,zoneOrder:0,zone:"deck",isSelected:!1,isActive:!1,isExhausted:!1,...t}),Ie=t=>{const a=[];for(let e=0;e<5;e++){const n=J.blank;a.push(X(n,a.length+1))}const r=ue(Re);return a.push(me(r[0],"player")),a.push(me(r[1],"opponent")),le.forEach(e=>{const n=J[e+"Rift"];a.push(X(n,a.length+1))}),le.forEach(e=>{const n=J[e+"Echo"];a.push(X(n,a.length+1))}),le.forEach(e=>{const n=J[e+"Omen"];a.push(X(n,a.length+1))}),ue(a).map((e,n)=>(e.zoneOrder=n,e))},$e=["deal","take","end"],Y=["deck","opponentPlay","opponentGoal","pile1","pile2","pile3"],V=["takeModal","playerPlay","active","playerGoal"],Fe=Ie(),Le=()=>new Promise(t=>{t({isIntroSkipped:!1,isUiHidden:!0,storyIndex:0,isStarted:!1,isPhaseButtonDisabled:!0,isPileToPlay:"deck",winner:void 0,activePlayer:"player",currentPhase:void 0,phases:$e,isModalOpen:!1,ui:{},cards:[...Fe],selectedPile:"pile1",pile1:[],pile2:[],pile3:[],player:{id:1,hand:[],play:[],isComputer:!1},opponent:{id:2,hand:[],play:[],isComputer:!0}})}),pe=["","Well, well, well. Look what we have here?","A small flicker of light at dusk.","Delicious. I so rarely get guests","I so rarely get any guests... guests.","It's all so terrIBLY BORING I JUST WANT...","...I'm sorry I forget myself, forgot myself.","Welcome, you who stands at the edge twilight.","Come, sit with me and play a game.","It tastes like cards, and you wager yourself.","The night is almost here... you get the first play."],ee=new Map,te=new Map;function Ge({containerSelector:t=".card-container",faceUpClass:a="face-up",faceDownClass:r="face-down"}={}){return{startFlip(o){ee.clear(),document.querySelectorAll("[data-flip]").forEach(e=>{const n=e.getAttribute("data-flip");if(!n)return;const l=e.getBoundingClientRect();ee.set(n,l)})},endFlip(o=200,e){return new Promise(n=>{const l=[];document.querySelectorAll("[data-flip]").forEach(c=>{const f=c.getAttribute("data-flip");if(!f)return;const h=ee.get(f);if(!h)return;const w=c.getBoundingClientRect(),k=h.left-w.left,C=h.top-w.top;(k||C)&&(c.style.transform=`translate(${k}px, ${C}px)`,l.push(c));const $=e.cards.find(O=>O.id===parseInt(f,10)),z=$==null?void 0:$.zone,A=te.get(f),b=c.querySelector(t);b&&(Y.includes(A)&&V.includes(z)?(b.classList.remove(r),b.classList.add(a)):V.includes(A)&&Y.includes(z)&&(b.classList.remove(a),b.classList.add(r))),te.set(f,z)}),document.querySelectorAll("[data-face]").forEach(c=>{var k;const f=c.getAttribute("data-face");if(!f)return;const h=(k=e.cards.find(C=>C.id===parseInt(f,10)))==null?void 0:k.zone,w=te.get(f);w&&(h!==w&&(Y.includes(w)&&V.includes(h)&&(c.classList.remove(r),c.classList.add(a)),V.includes(w)&&Y.includes(h)&&(c.classList.remove(a),c.classList.add(r))),te.set(f,h))}),requestAnimationFrame(()=>{l.forEach(c=>{c.style.transition=`transform ${o}ms ease`,c.style.transform=""}),setTimeout(()=>{l.forEach(c=>{c.style.transition=""}),ee.clear(),n()},o)})})}}}const je=I("🌌",{size:500,cell:15}),ge=new Map;function j(t,a,r=!1,o){var f,h;let e=t.types[0];(t.zone==="playerGoal"||t.zone==="opponentGoal")&&(e="multi");const n=ge.get(t.id),l=t.zone;let c="face-down";return n&&l&&(V.includes(n)&&V.includes(l)?c="face-up":Y.includes(n)&&Y.includes(l)&&(c="face-down")),r===!0&&(c="face-up"),ge.set(t.id,l),x`
    <div class="card-wrapper ${t.zone==="active"?"active-card":""} ${t.isExhausted?"played":""}" ${a?"":"data-flip="+t.id}>
      <div class="card-container ${c}" data-face="${t.id}">
        <div class="card ${o?"pulse-border":""}">
          <div class="card-face front ${e}">
            <div class="card-name">${t.name}</div>
            <img class="card-image" src="${t.cardArt}">
            ${t.isExhausted?"":x`<div class="card-type">${(f=t.types)==null?void 0:f.join(" - ")}</div>`}
            <div class="card-rules">${(h=t.abilityRule)==null?void 0:h.join(`
`)}</div>
          </div>

          <div class="back">
          <img class="back-pattern" src="${je}">
          </div>
        </div>
      </div>
    </div>
  `}function qe(t){return x`
        <div class="dialog">
            <div class="game-rules-wrapper">
                <div class="flex-col">
                    <div>Goal: If a player ends their turn with 15 cards in their play area they lose the game. If a player ends the turn with their goal card requirments met they win the game.</div>
                    <div>m Key: Turn on music - s Key: Skip intro</div>
                    <div>
                        <ol>
                            <li>Each turn a card is dealt to each of 3 piles.</li>
                            <li>Then the active player chooses a pulsing blue pile.</li>
                            <li>All cards from the chosen pile are played in the chosen numerical order.</li>
                            <li>Played cards go to the bottom of the deck.</li>
                            <li>If the active player does not win or lose the game their opponent goes and the above steps are repeated.</li>
                        </ol>
                    </div>
                    <div>
                    <h3>Terms</h3>
                    <ul>
                        <li>Flood: Force your opponent to draw a card and put it in their play area.</li>
                        <li>Exhausted: Cards can become exhausted in play areas. They are no longer counted by your goal card for winning but they are counted towards the 15 cards that cause you to lose the game.</li>
                        <li>Return: Return a card from your play area to the bottom of the deck. Exhausted cards are returned first followed by the last card you played.</li>
                        <li>Goal Card: You start with a goal card visible only to you. If at anytime the goals requirments are met you win the game.</li>
                    </ul>
                    </div>
                    <div><button class="jagged" onclick="methods.cancelPlayModal()">Start the Game</button></div>
                </div>
            </div>
        </div>
  `}function Ne(t){let a=y(t.cards,"playerPlay").filter(e=>e.types.includes("rift")),r=y(t.cards,"playerPlay").filter(e=>e.types.includes("echo")),o=y(t.cards,"playerPlay").filter(e=>e.types.includes("omen"));return x`
        <div class="dialog">
            <div>
                <div>Select this pile of cards by clicking the take button. Cards resolve in numerical order.</div>
                <div>Your play area has ${a.length} rifts, ${r.length} echos, and ${o.length} omens</div>
            </div>
            <div class="flex-column">
                <div class="flex-cards">
                ${G(t.cards,"takeModal",(e,n)=>{var l;return x`
                        <div>
                            <div class="deck-card-wrapper">${j(e,!0,!1,!0)}</div>
                        ${((l=y(t.cards,"takeModal"))==null?void 0:l.length)>1?x`<div class="number-buttons-wrapper"><button class="jagged" onclick="methods.orderCards(${e.id}, false)">⬅</button><div class="number">${n+1}</div><button class="jagged" onclick="methods.orderCards(${e.id}, true)">⮕</button></div>`:""}
                        </div>`})}
                </div>

            </div>
            <div class="flex-row dialog-ui">
                <button class="jagged" onclick="methods.cancelTakeModal()">Close</button>
                <button class="jagged" onclick="methods.submitTakeModal()">Take & Pass</button>
            </div>
        </div>
  `}function Be(t){const a=$e[t.currentPhase],o=(t.currentPhase?["play","end"]:["take","end"]).includes(a)?t.activePlayer==="player"?"opponent":"player":t.activePlayer;return x`
    <div class="${t.isStarted?"hidden":""}" id="story-wrapper">
        ${he(pe,(e,n)=>n>t.storyIndex?null:n===t.storyIndex?x`<div class="last-line">${e}</div>`:x`<div>${e}</div>`)}
    </div>
    <div class="${t.isStarted?"":"ui-wrapper"}">
        <div>
            <div class="phases-wrapper ${o!=="player"?"void-phase jagged":""}">
                ${o==="player"?"YOUR TURN: ":"VOID'S TURN: "}
                ${he(t.phases,(e,n)=>x`<div class="phase-wrapper ${t.currentPhase===n?"active":""}">${e.toUpperCase()}</div>`)}
            </div>
            <div class="game-area-wrapper">
                <div class="deck-dealt-wrapper">
                    <div class="deck-wrapper">${G(t.cards,"deck",(e,n)=>x`<div class="deck-card-wrapper" style="${"bottom:"+Math.floor(n/3)+"px;right:"+Math.floor(n/6)+"px"}">${j(e,!1,!1,!1)}</div>`)}</div>
                    <div class="pile-wrapper pile-1-wrapper">${G(t.cards,"pile1",(e,n)=>x`<div onclick="methods.viewPile('pile1')" class="pile" style="${"bottom:"+n*2+"px;right:"+n*2+"px"}">${j(e,!1,!1,!1)}</div>`)}</div>
                    <div class="pile-wrapper pile-2-wrapper">${G(t.cards,"pile2",(e,n)=>x`<div onclick="methods.viewPile('pile2')" class="pile" style="${"bottom:"+n*2+"px;right:"+n*2+"px"}">${j(e,!1,!1,!1)}</div>`)}</div>
                    <div class="pile-wrapper pile-3-wrapper">${G(t.cards,"pile3",(e,n)=>x`<div onclick="methods.viewPile('pile3')" class="pile" style="${"bottom:"+n*2+"px;right:"+n*2+"px"}">${j(e,!1,!1,!1)}</div>`)}</div>
                </div>
                
            </div>

        </div>
        <div class="flex-row-top">
            <div class="play-area-wrapper area-wrappers play-area-min-height">
                <div class="play-area-header">⚪ YOUR PLAY AREA (${y(t.cards,"playerPlay").length})</div>
                <div class="flex-cards">
                ${G(t.cards,"playerGoal",(e,n)=>x`<div>${j(e,!0,!0)}</div>`)}
                ${G(t.cards,"playerPlay",(e,n)=>x`<div>${j(e,!1,!1,!1)}</div>`)}
                </div>
            </div>

            <div class="play-area-wrapper area-wrappers play-area-min-height">
                <div class="play-area-header">⚫ THE VOIDS'S PLAY AREA (${y(t.cards,"opponentPlay").length})</div>
                <div class="flex-cards">
                    ${G(t.cards,"opponentGoal",(e,n)=>x`<div>${j(e,!0,!!t.winner)}</div>`)}
                    ${G(t.cards,"opponentPlay",(e,n)=>x`<div class="pile">${j(e,!1,!!t.winner,!1)}</div>`)}
                </div>
            </div>    
        
        </div>
        </div>  
        <div class="dialog-wrapper ${t.isModalOpen||t.storyIndex===0?"":"hidden"}">
            ${t.storyIndex===0?qe():null}
            ${t.currentPhase===1&&t.isStarted===!0?Ne(t):null}
        </div>
        <div class="active-card-wrapper flex-row">
            ${G(t.cards,"active",(e,n)=>x`<div class="pile">${j(e,!1,!1,!1)}</div>`)}
        </div>
 
  `}const De=I("😶",{size:500,cell:20}),ve=t=>x`
        <div class="eye-wrapper" ${t?"style='transform: scaleX(-1)'":""}>
            <img class="eye-background" src="${De}">
            <svg class="eye-layer" viewBox="0 0 622 500" preserveAspectRatio="xMaxYMin">
                <g class="layer">
                <path class="upper-brow" d="m-6,0l649,0l0,890c-119.17,-95.85 -41.92,-306.25 -163.12,-392.89c-104.61,-77.09 -381.27,-13.02 -485.88,-90.11z" fill="#000000" id="svg_16" stroke="#000000" stroke-width="0"/>
                <path d="m-3,-1c0.68,161 1.35,322 2.03,483l642.97,0c-94.8,-70.22 -336.89,9.59 -431.69,-60.63c-120.2,-90.78 -93.11,-331.59 -213.31,-422.37z" fill="#000000" id="svg_17" stroke="#000000" stroke-width="0"/>
                <path class="iris" d="m330.55,45c-23.96,49.98 -25.34,117.3 -27.43,197.88c0.34,140.76 19.85,202.98 27.97,210.12c0.27,0 25.44,-22.44 24.94,-210.12c-0.65,-149.94 -25.48,-197.88 -25.48,-197.88z" fill="#000000" stroke="#000000" stroke-width="0"/>
                </g>
            </svg>
        </div>
    `,Ue=()=>x`
        <div class="eyes-wrapper">
            ${ve(!1)}
            ${ve(!0)}
        </div>
    `,Ae=(t,a)=>{if(console.log(a),typeof a!="number"||a<=0){const r=t.get(),o=r.activePlayer==="player"?"player":"opponent";let e=0;for(let n=0;n<r[o].play.length;n++)r[o].play[n].types.includes(a)&&r[o].play[n].isExhausted===!1&&e++;return e}return a},Ee=async(t,a)=>{for(let r=0;r<t&&await a(r)!==!1;r++);};async function ce(t,a,r){const o=Ae(t,r);await Ee(o,async()=>{const e=t.get(),n=y(e.cards,"deck"),l=n[n.length-1];if(!l)return!1;l.zone=`${a}Play`,t.set(e),await S(1e3)})}async function Ye(t,a,r){const o=Ae(t,r);await Ee(o,async()=>{const e=t.get(),n=`${a}Play`,l=y(e.cards,n);if(!l.length)return!1;const f=l.find(w=>w.isExhausted)??l[l.length-1];if(!f||f.zone==="playerGoal"||f.zone==="opponentGoal")return!1;const h=y(e.cards,"deck");f.zone="deck",f.zoneOrder=h[h.length-1].zoneOrder+1,f.isExhausted=!1,t.set(e),await S(1e3)})}const we={floodOpponent$Time:async(t,a,r)=>{await ce(t,a==="player"?"opponent":"player",r)},floodAllPlayers$Time:async(t,a,r)=>{await ce(t,"player",r),await ce(t,"opponent",r)},return$Time:async(t,a,r)=>{await Ye(t,a,r)},returnAllExhaustedCards:async(t,a,r)=>{await S(1e3);const o=t.get();let e=o.activePlayer==="player"?y(o.cards,"playerPlay"):y(o.cards,"opponentPlay");const n=y(o.cards,"deck");for(let l=0;l<e.length;l++){const c=e[l];c.isExhausted&&(c.zone=n,c.zoneOrder=n[n.length-1].zoneOrder+1)}t.set(o)},unexhaustAllYourExhaustedCards:async(t,a,r)=>{await S(1e3);const o=t.get();let e=o.activePlayer==="player"?y(o.cards,"playerPlay"):y(o.cards,"opponentPlay");for(let n=0;n<e.length;n++){const l=e[n];l.isExhausted&&(l.isExhausted=!1)}t.set(o)},remianingCardsInPileGoToYourPlayArea:async(t,a,r)=>{await S(1e3);const o=t.get();o.isPileToPlay="next",t.set(o)},exhaust$OfYourOpponentsUnexhaustedCardsAtRandom:async(t,a,r)=>{await S(1e3);const o=t.get();let n=o.activePlayer==="opponent"?y(o.cards,"playerPlay"):y(o.cards,"opponentPlay");const l=n.map(h=>h.id),c=ue(l);let f=0;for(let h=0;h<c.length;h++){const w=n.find(k=>k.id===c[h]);if(!w.isExhausted&&(w.zone!=="playerGoal"||w.zone!=="opponentGoal")&&(w.isExhausted=!0,f++),f>=r)break}t.set(o)}},Ve=(t,a,r)=>{const o=typeof a=="object"&&a?a:{wave:typeof a=="string"?a:"sine",musicLength:void 0},e=o.wave||"sine",n=o.musicLength??.1,l=o.transposeOctaves??-2,c=o.transposeSemitones??0,f=o.baseHz??440,h=o.baseCharCode??105,w=o.filterCutoff??450,k=o.filterQ??10,C=o.subLevel??.35,$=o.subOctaves??1,z=o.gain??.45,A=o.attack??.01,b=o.decay??.12,O=o.sustain??.2,u=o.release??.3,m=o.vibratoRate??5,v=o.vibratoDepth??12,M=o.delayTime??.23,L=o.delayFeedback??.33,R=o.delayWet??.25,K={5:.4,4:.3,3:.2,2:.1,1:.05},s=[...Object.keys(K),"-"];window.AudioContext=window.AudioContext||window.webkitAudioContext;const i=new AudioContext,d=i.createGain();d.gain.value=.9,d.connect(i.destination);const p=i.createDelay(1.5);p.delayTime.value=M;const g=i.createGain();g.gain.value=L;const P=i.createGain();P.gain.value=R,p.connect(g),g.connect(p),p.connect(P),P.connect(d);for(let E=0;E<t.length;E++){const B=t[E],q=t[E+1],F=isNaN(q)?n:K[q];if(!B||s.includes(B))continue;const T=i.currentTime+E*F+.3,Q=T+F,Te=t.charCodeAt(E)-h+l*12+c,ne=f*Math.pow(2,Te/12),D=i.createOscillator();D.type=e,D.frequency.setValueAtTime(ne,T);const Z=i.createOscillator();Z.type=e==="square"?"sine":e;const Ce=ne/Math.pow(2,$);Z.frequency.setValueAtTime(Ce,T);const oe=i.createGain();oe.gain.value=C;const U=i.createBiquadFilter();U.type="lowpass",U.frequency.setValueAtTime(w,T),U.Q.setValueAtTime(k,T);const N=i.createGain();if(N.gain.setValueAtTime(1e-4,T),N.gain.linearRampToValueAtTime(z,T+A),N.gain.linearRampToValueAtTime(z*O,T+A+b),N.gain.setTargetAtTime(1e-4,Math.max(T,Q-u),.15),v>0){const _=i.createOscillator(),re=i.createGain();_.frequency.setValueAtTime(m,T);const ze=Oe=>Oe*(Math.pow(2,v/1200)-1);re.gain.value=ze(ne),_.connect(re),re.connect(D.frequency),_.start(T),_.stop(Q+.1)}D.connect(U),Z.connect(oe),oe.connect(U),U.connect(N),N.connect(d),N.connect(p),D.start(T),Z.start(T),D.stop(Q+.05),Z.stop(Q+.05)}},Ze=()=>{const t=["m5","k5","h5","o5","g5","k3","h3","m3","k2","h2","m4"],a=["-m5-k5-h5-m5-","-m5-k5-h5-k5-","-o5-m5-k5-h5-","-h5-g5-k5-h5--","-k3-h3-m5--k3-h3-m5--","-m5-m5-k5-h5-m5--","-a5-h5-g5-d5-c5-a5-a5-","-a5-h5-g5-d5-c5-k25-k25-","-o5-j5-k5-g5-h5-h5-c5-","-m5-g5-j5-c5-h3"];let r="";for(let o=0;o<200;o++){const e=Math.random()>.7?"---":"--",n=Math.random()>.9?fe(t):fe(a);r+=n+e}Ve(r,{wave:"sawtooth",musicLength:.4,transposeOctaves:-3,filterCutoff:320,filterQ:14,subLevel:.45,subOctaves:2,attack:.03,decay:.2,sustain:.35,release:.6,vibratoRate:4,vibratoDepth:14,delayTime:.38,delayFeedback:.38,delayWet:.22,gain:.2})},be=Ge();let Pe=!1,H=0,de=!1;const He=(t,a)=>a.length>1?t[a[0]][a[1]]:t[a[0]],We=document.querySelector("#app"),Ke=document.querySelector("#eyes"),Qe=async t=>{be.startFlip(t),xe(We,()=>Be(t)),be.endFlip(500,t)};setTimeout(()=>{_e()},200);async function _e(){const t=()=>{H++},a=()=>{H=Math.max(0,H-1),H===0&&de&&(de=!1,k())},r=async()=>{if(H>0){de=!0;return}await k()};if(Pe)return;Pe=!0;const o=await Le(),e=Me(o,Qe);Je(),Xe(e),xe(Ke,()=>Ue());const n=()=>{const s=e.get();return s.phases[s.currentPhase??0]},l=s=>n()===s,c=s=>{const i=e.get(),p=y(i.cards,"deck")[0].zoneOrder,g=i.cards.find(P=>P.id===s);if(i.isPileToPlay==="play"){const P=i.activePlayer==="player"?"playerPlay":"opponentPlay";g.zone=P}else g.zone="deck",g.zoneOrder=p+1;i.isPileToPlay==="next"&&(i.isPileToPlay="play"),e.set(i)},f=async()=>{for(let s=1;s<=3;s++){const i=e.get(),d=y(i.cards,"deck"),p=d[d.length-1];if(!p)break;p.zone=`pile${s}`,e.set(i)}},h=async(s,i,d)=>{if(!s||!Array.isArray(s.abilityFunct))return;t();for(let E=0;E<s.abilityFunct.length;E++){const B=s.abilityFunct[E],[q,F]=String(B).split(":");let T=F?parseInt(F,10):0;Number.isNaN(T)&&(T=F),we[q]&&await we[q](e,i,T)}const p=e.get();let g;d.length>1?g=p[d[0]][d[1]]:g=p[d[0]];const P=g.find(E=>E.id===s.id);if(P){const E=y(p.cards,"deck");P.zone="deck",P.zoneOrder=E[E.length-1].zoneOrder+1,e.set(p)}a()},w=()=>{const s=e.get(),i=s.currentPhase===void 0||s.currentPhase+1>=s.phases.length?0:s.currentPhase+1;return s.currentPhase=i,e.set(s),s.phases[i]};async function k(){const s=e.get();if(s.winner){alert(`${s.winner} has won the game`);return}const i=w();s.activePlayer==="player"?await $(i):await z(i)}const C=s=>{const i=e.get();i.isPhaseButtonDisabled=s,e.set(i)};async function $(s){C(!0),s==="deal"&&(ie(!0),await await f(),await S(500),await r()),s!=="take"&&s==="end"&&(M(),await r())}async function z(s){C(!0),s==="deal"&&(ye(!0),await f(),await S(500),await r()),s==="take"&&(await A(),await S(3e3),C(!1)),s==="end"&&(ye(!1),M(),await r())}async function A(){t(),ie();const s=e.get(),i=y(s.cards,"pile1").length,d=y(s.cards,"pile2").length,p=y(s.cards,"pile3").length;i>=d&&i>=p?s.selectedPile="pile1":d>=i&&d>=p?s.selectedPile="pile2":s.selectedPile="pile3",e.set(s),await S(200),await b(),a(),await r()}async function b(){for(;;){const i=e.get(),d=y(i.cards,i.selectedPile).reverse();if(!Array.isArray(d)||d.length===0)break;const p=d[d.length-1];if(!p)break;p.isFaceUp=!0,p.zone="active",e.set(i),await S(2e3),await h({...p},i.activePlayer,[i.selectedPile]),c(p.id),await S(1e3)}const s=e.get();s.isPileToPlay="deck",s.player.play=s.player.play.sort(i=>i.isExhausted),s.opponent.play=s.opponent.play.sort(i=>i.isExhausted),e.set(s)}const O=()=>{ie(!1,750);const s=e.get();s.isModalOpen=!1,e.set(s),u()};function u(){var i;const s=e.get();s.storyIndex>=pe.length-1?(s.isModalOpen=!1,s.isStarted=!0,e.set(s),window.methods.advancePhase()):(s.storyIndex=s.storyIndex+1,e.set(s),setTimeout(u,3e3),(i=document.querySelector(".last-line"))==null||i.classList.add("visible"))}const m=async()=>{const s=e.get();s.isModalOpen=!1,y(s.cards,"takeModal").forEach(d=>d.zone=s.selectedPile),e.set(s),t(),await S(500),await b(),await S(500),a(),await r()},v=()=>{if(!l("take"))return;const s=e.get();if(s.activePlayer==="opponent")return;const i=y(s.cards,"takeModal");s.isModalOpen=!1,i.forEach(d=>{console.log(d.zone),d.zone=s.selectedPile,console.log(d.zone)}),e.set(s)};function M(){const s=e.get(),i=y(s.cards,"playerPlay"),d=y(s.cards,"opponentPlay"),p=y(s.cards,"playerGoal"),g=y(s.cards,"opponentGoal"),P=p[0].types[0],E=g[0].types[0],B=i.filter(F=>F.isExhausted===!1&&F.types.includes(P)),q=d.filter(F=>F.isExhausted===!1&&F.types.includes(E));console.log(),(s.activePlayer==="player"&&i.length>=15||s.activePlayer==="opponent"&&q.length>10)&&(s.winner="opponent"),(s.activePlayer==="opponent"&&d.length>=15||s.activePlayer==="player"&&B.length>10)&&(s.winner="player"),s.activePlayer=s.activePlayer==="player"?"opponent":"player",e.set(s)}const L=s=>{if(!l("take"))return;const i=e.get();if(i.activePlayer==="opponent")return;const d=y(i.cards,s);i.selectedPile=s,i.isModalOpen=!0,d.forEach(p=>{p.zone="takeModal"}),e.set(i)},R=(s,i)=>{const d=e.get(),p=He(d,s),g=p==null?void 0:p.find(P=>P.id===i);g&&(g.isSelected=!g.isSelected,e.set(d))},K=(s,i)=>{const d=e.get(),p=y(d.cards,"takeModal");p.forEach((g,P)=>{g.id===s?g.zoneOrder=i?P+1.5:P-1.5:g.zoneOrder=P}),p.sort((g,P)=>g.zoneOrder-P.zoneOrder).reverse().forEach((g,P)=>{g.zoneOrder=P+1}),e.set(d)};window.methods={advancePhase:k,submitTakeModal:m,cancelTakeModal:v,cancelPlayModal:O,setSelected:R,viewPile:L,orderCards:K}}function Je(){document.addEventListener("keydown",t=>{t.key.toLowerCase()==="m"&&Ze()})}function Xe(t){document.addEventListener("keydown",a=>{if(a.key.toLowerCase()==="s"){const r=t.get();r.isModalOpen=!1,r.isStarted=!0,r.storyIndex=pe.length,t.set(r),window.methods.advancePhase()}})}
